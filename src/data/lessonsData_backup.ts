// 学習ステップの落とし穴の型定義
interface Pitfall {
    title: string;
    detail: string;
}

// 練習問題の型定義
export interface Problem {
    question: string;
    answer: string;
    hint: string;
}

// 学習ステップの型定義
export interface LearningStep {
    title: string;
    explanation: string;
    pitfall: Pitfall;
    problems?: Problem[];
}

// 学習トピックの型定義
export interface LearningTopic {
    topic: string;
    steps: LearningStep[];
}

// 科目データの型定義
interface SubjectData {
    [key: string]: LearningTopic[];
}

// LaTeX変換用の正規表現置換関数
export function toLatexMath(str: string): string {
    if (!str) return str;
    let s = str;
    // 「ポイント：」の前後に改行を追加
    s = s.replace(/\n?\s*ポイント：/g, "\n\nポイント：\n");
    // 改行を<br>に変換
    s = s.replace(/\n/g, "<br>");
    // sqrt(2) → \sqrt{2}
    s = s.replace(/sqrt\(([^)]+)\)/g, "\\sqrt{$1}");
    // <=, >=
    s = s.replace(/<=/g, " \\le ");
    s = s.replace(/>=/g, " \\ge ");
    // pi → \pi
    s = s.replace(/\bpi\b/g, "\\pi");
    // 分数 例: 1/2 → \frac{1}{2}（ただし小数や式の一部でない場合のみ）
    s = s.replace(
        /(?<![\d.])([0-9]+)\s*\/\s*([0-9]+)(?![\d.])/g,
        "\\frac{$1}{$2}"
    );
    // 乗数 例: x^2 → x^{2}
    s = s.replace(/([a-zA-Z0-9]+)\^(-?[a-zA-Z0-9]+)/g, "$1^{$2}");
    return s;
}

// problemsのanswerをLaTeX記法に自動変換
function normalizeProblems(problems: Problem[]): Problem[] {
    return problems.map((p) => {
        let answer = p.answer;
        if (typeof answer === "string") {
            answer = toLatexMath(answer);
        }
        return { ...p, answer };
    });
}

// 数学I の学習コンテンツ
const math1Lessons: LearningTopic[] = [
    {
        topic: "式の計算",
        steps: [
            {
                title: "多項式の展開と因数分解",
                explanation: `
  「展開」とは、かっこの中にある式を分配法則で広げて、かっこをなくすことです。
  たとえば、$(x+2)(x+3)$ のような式を、$x^2 + 5x + 6$ のように書き直します。

  「因数分解」とは、展開の逆で、バラバラになっている式をかっこの形にまとめることです。
  たとえば、$x^2 + 5x + 6$ を $(x+2)(x+3)$ のようにします。

  ポイント：
  ・展開は「かっこを外す」
  ・因数分解は「かっこを作る」
  ・どちらも計算の基本なので、しっかり練習しましょう！
`,
                pitfall: {
                    title: "よくある間違い：符号ミスや項の漏れ",
                    detail: `
展開では、すべての項を掛け合わせているか、符号が正しいかを確認しましょう。
因数分解では、公式を正しく適用できているか、共通因数を見落としていないか注意が必要です。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$(x+3)(x-2)$ を展開しなさい。",
                        answer: "$x^2+x-6$",
                        hint: "分配法則を使いましょう。",
                    },
                    {
                        question: "$x^2 - 5x + 6$ を因数分解しなさい。",
                        answer: "$(x-2)(x-3)$",
                        hint: "掛けて6、足して-5になる2つの数を見つけましょう。",
                    },
                ]),
            },
            {
                title: "実数と根号",
                explanation: `
  「実数」とは、分数で表せる数（有理数）と、分数で表せない数（無理数）を合わせたものです。
  たとえば、1/2 や 3 は有理数、√2 や π は無理数です。

  「根号（ルート）」の計算では、
  ・$\\sqrt{a} × \\sqrt{b} = \\sqrt{a×b}$
  ・$\\sqrt{a} ÷ \\sqrt{b} = \\sqrt{a÷b}$
  などの性質を使います。

  また、分母にルートがあるときは「有理化」といって、分母からルートをなくす工夫をします。
  例：$\\frac{1}{\\sqrt{2}} → \\frac{\\sqrt{2}}{2}$

  ポイント：
  ・ルートの計算は、できるだけ中を小さくする
  ・分母にルートがあれば有理化する
`,
                pitfall: {
                    title: "よくある間違い：根号の足し算・引き算",
                    detail: `
$\\sqrt{2} + \\sqrt{3} = \\sqrt{5}$ のように計算してしまうのは間違いです。
根号の中の数が同じ場合のみ、係数を足し引きできます。例：$2\\sqrt{3} + 4\\sqrt{3} = 6\\sqrt{3}$
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$\\sqrt{18} + \\sqrt{8}$ を簡単にしなさい。",
                        answer: "$5\\sqrt{2}$",
                        hint: "根号の中をできるだけ小さくしましょう。",
                    },
                    {
                        question: "$\\frac{1}{\\sqrt{3}-1}$ を有理化しなさい。",
                        answer: "$\\frac{\\sqrt{3}+1}{2}$",
                        hint: "分母と分子に何を掛ければ良いでしょうか？",
                    },
                ]),
            },
        ],
    },
    {
        topic: "方程式と不等式",
        steps: [
            {
                title: "1次方程式・不等式",
                explanation: `
  「1次方程式」とは、$x$などの文字が1回だけ出てくる式 $ax+b=0$ のことです。
  文字を含む項を片側に、数字だけの項をもう片側に集めて、xを求めます。

  「1次不等式」は、$ax+b>0$ のように不等号 $>$ や $<$ がついた式です。
  解き方は方程式とほぼ同じですが、
  「両辺をマイナスで割るときは、不等号の向きが逆になる」ことに注意しましょう。

  ポイント：
  ・方程式は「$=$」で、答えは1つ
  ・不等式は「$>$」「$<$」などで、答えが範囲になることもある
  ・マイナスで割るときは不等号の向きに注意！
`,
                pitfall: {
                    title: "よくある間違い：負の数で割る際の不等号の向き",
                    detail: `
$-2x > 4$ を解く際に、$x > -2$ としてしまうのは間違いです。
両辺を負の数 $(-2)$ で割るため、不等号の向きが逆になり、$x < -2$ が正解です。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$3x - 5 = 7$ を解きなさい。",
                        answer: "$4$",
                        hint: "定数項を右辺に移項しましょう。",
                    },
                    {
                        question: "$2x + 3 < 7$ を解きなさい。",
                        answer: "$x<2$",
                        hint: "負の数で割る場合に注意しましょう。",
                    },
                ]),
            },
            {
                title: "2次方程式",
                explanation: `
  「2次方程式」とは、$x^2$が出てくる式 $ax^2+bx+c=0$ のことです。
  解き方はいくつかあります。
  ・因数分解（かっこにまとめる）
  ・平方完成（$x^2$の形に直す）
  ・解の公式（どんな式でも使える便利な公式）

  また、「判別式 $D=b^2-4ac$」を使うと、答えが何個あるかも分かります。

  ポイント：
  ・まずは因数分解できるか考える
  ・できなければ平方完成や解の公式を使う
  ・判別式で答えの個数もチェック！
`,
                pitfall: {
                    title: "よくある間違い：解の公式の符号ミス",
                    detail: `
解の公式の $-b$ や $2a$ の符号、$\\pm$ の後の根号内の計算ミスが多いです。
特に、判別式 $D$ の計算は慎重に行いましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$x^2 - 5x + 6 = 0$ を解きなさい。",
                        answer: "$2, 3$",
                        hint: "因数分解を試みましょう。",
                    },
                    {
                        question: "$x^2 + 2x - 1 = 0$ を解きなさい。",
                        answer: "$-1±\\sqrt{2}$",
                        hint: "解の公式を使いましょう。",
                    },
                ]),
            },
            {
                title: "2次不等式",
                explanation: `
  「2次不等式」とは、$x^2$が出てくる不等式 $ax^2+bx+c>0$ などのことです。
  2次関数のグラフ（放物線）とx軸の位置関係を考えて、どの範囲で条件を満たすかを調べます。

  たとえば、グラフがx軸より上にある部分が「$>0$」、下にある部分が「$<0$」に対応します。

  ポイント：
  ・まず2次方程式でx軸との交点（解）を求める
  ・グラフの形（上に凸か下に凸か）を確認
  ・どの範囲で条件を満たすか、グラフでイメージしよう！
`,
                pitfall: {
                    title: "よくある間違い：グラフの概形と不等号の向き",
                    detail: `
2次不等式を解くには、対応する2次方程式の解（x軸との交点）を求め、グラフの概形（上に凸か下に凸か）を正確に把握することが重要です。
不等号の向きと、グラフのどの部分が条件を満たすのかを混同しないようにしましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$x^2 - 4x + 3 > 0$ を解きなさい。",
                        answer: "$x<1, x>3$",
                        hint: "対応する2次方程式の解を求め、グラフを描いてみましょう。",
                    },
                    {
                        question: "$x^2 - 2x - 8 \\le 0$ を解きなさい。",
                        answer: "$-2\\le x\\le 4$",
                        hint: "因数分解して、x軸との交点を見つけましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "2次関数",
        steps: [
            {
                title: "2次関数のグラフ",
                explanation: `
  2次関数 $y=ax^2+bx+c$ のグラフは「放物線」と呼ばれる曲線です。
  標準形 $y=a(x-p)^2+q$ に直すと、頂点（グラフの一番高い・低い点）が$(p, q)$とすぐに分かります。

  $a$ がプラスなら下に開いたU字型、マイナスなら上に開いた山型になります。

  ポイント：
  ・標準形に直すと頂点が分かりやすい
  ・$a$ の符号でグラフの向きが決まる
  ・グラフを描いてイメージしよう！
`,
                pitfall: {
                    title: "よくある間違い：頂点の符号ミス",
                    detail: `
$y = a(x-p)^2 + q$ の頂点は $(p, q)$ ですが、$y = (x+1)^2 + 2$ の頂点を $(1, 2)$ と間違えることがあります。
正しくは $(-1, 2)$ です。$(x-p)$ の形に注意しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "2次関数 $y = (x-3)^2 + 1$ の頂点の座標を求めなさい。",
                        answer: "$(3,1)$",
                        hint: "標準形 $y = a(x-p)^2 + q$ の頂点は $(p, q)$ です。",
                    },
                    {
                        question:
                            "2次関数 $y = x^2 - 4x + 5$ の頂点の座標を求めなさい。",
                        answer: "$(2,1)$",
                        hint: "平方完成して標準形にしましょう。",
                    },
                ]),
            },
            {
                title: "2次関数の最大・最小",
                explanation: `
  2次関数の「最大値・最小値」は、グラフの頂点や、$x$ の範囲（定義域）の端で決まります。
  まず頂点の $y$ 座標を調べ、次に $x$ の範囲の端でも $y$ の値を計算して、一番大きい・小さい値を比べます。

  グラフを描いて、どこが一番高いか・低いかを考えると分かりやすいです。

  ポイント：
  ・頂点が範囲内にあるかチェック
  ・端の値も必ず計算する
  ・グラフで視覚的に考えるとミスが減る！
`,
                pitfall: {
                    title: "よくある間違い：定義域の考慮不足",
                    detail: `
頂点が定義域の外にある場合でも、頂点の $y$ 座標を最大値・最小値としてしまう間違いが多いです。
必ず、定義域の端点での値も計算し、それらと頂点の $y$ 座標を比較して、最も大きい値が最大値、最も小さい値が最小値であることを確認しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "関数 $y = (x-1)^2 + 2$ の $0 \\le x \\le 3$ における最大値と最小値を求めよ。",
                        answer: "最大値: $6$, 最小値: $2$",
                        hint: "グラフの頂点と定義域の端点での値を比較しましょう。",
                    },
                    {
                        question:
                            "関数 $y = (x-3)^2 + 1$ の $0 \\le x \\le 2$ における最大値と最小値を求めよ。",
                        answer: "最大値: $10$, 最小値: $2$",
                        hint: "グラフの頂点と定義域の端点での値を比較しましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "三角比",
        steps: [
            {
                title: "三角比の定義",
                explanation: `
  「三角比」とは、直角三角形の角度と辺の長さの関係を表す比（わり算）のことです。
  ・$\\sin$（サイン）＝対辺 ÷ 斜辺
  ・$\\cos$（コサイン）＝隣辺 ÷ 斜辺
  ・$\\tan$（タンジェント）＝対辺 ÷ 隣辺

  どんな大きさの三角形でも、同じ角度なら三角比の値は同じです。

  ポイント：
  ・「どの角度から見たか」で対辺・隣辺が変わる
  ・三角比は三角形の大きさに関係なく使える
`,
                pitfall: {
                    title: "よくある間違い：辺の対応関係の混同",
                    detail: `
どの辺が「対辺」「隣辺」「斜辺」なのかを、基準となる角度から見て正確に把握することが重要です。
特に、直角三角形の向きが変わると混乱しやすいので注意しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "直角三角形ABCで、$\\angle C = 90^\\circ$, AB=5, BC=3, CA=4 のとき、$\\sin A$ の値を求めなさい。",
                        answer: "$\\frac{3}{5}$",
                        hint: "角度Aから見て、対辺と斜辺はどれでしょうか？",
                    },
                    {
                        question:
                            "直角三角形ABCで、$\\angle C = 90^\\circ$, AB=10, BC=6 のとき、$\\cos B$ の値を求めなさい。",
                        answer: "$\\frac{3}{5}$",
                        hint: "三平方の定理でACの長さを求め、角度Bから見て隣辺と斜辺を確認しましょう。",
                    },
                ]),
            },
            {
                title: "三角比の相互関係",
                explanation: `
  三角比には、いくつかの大事な関係式があります。
  ・$\\sin^2 \\theta + \\cos^2 \\theta = 1$
  ・$\\tan \\theta = \\sin \\theta ÷ \\cos \\theta$
  ・$1 + \\tan^2 \\theta = 1 ÷ \\cos^2 \\theta$

  これらを使うと、1つの三角比の値から他の三角比も計算できます。

  ポイント：
  ・関係式を覚えておくと計算が楽になる
  ・角度によって符号（プラス・マイナス）が変わることもあるので注意
`,
                pitfall: {
                    title: "よくある間違い：象限による符号の変化",
                    detail: `
三角比の相互関係を使う際、角度がどの象限にあるかによって、$\\sin \\theta$, $\\cos \\theta$, $\\tan \\theta$ の符号が変わることに注意が必要です。
例えば、$\\cos \\theta$ が負になる場合、$\\sin \\theta = \\sqrt{1 - \\cos^2 \\theta}$ ではなく、$\\sin \\theta = \\pm \\sqrt{1 - \\cos^2 \\theta}$ と考える必要があります。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "$\\sin \\theta = \\frac{3}{5}$ のとき、$\\cos \\theta$ の値を求めなさい。（ただし、$0^\\circ < \\theta < 90^\\circ$）",
                        answer: "$\\frac{4}{5}$",
                        hint: "$\\sin^2 \\theta + \\cos^2 \\theta = 1$ を使いましょう。",
                    },
                    {
                        question:
                            "$\\tan \\theta = 2$ のとき、$\\cos \\theta$ の値を求めなさい。（ただし、$0^\\circ < \\theta < 90^\\circ$）紅",
                        answer: "1/sqrt(5)",
                        hint: "$1 + \\tan^2 \\theta = \\frac{1}{\\cos^2 \\theta}$ を使いましょう。",
                    },
                ]),
            },
            {
                title: "正弦定理・余弦定理",
                explanation: `
  「正弦定理」と「余弦定理」は、三角形の辺の長さや角度を求めるときに使う公式です。
  ・正弦定理：辺と向かい合う角のペアが分かっているとき
  ・余弦定理：2辺とその間の角、または3辺が分かっているとき

  直角三角形でなくても使えるので、いろいろな三角形の問題に役立ちます。

  ポイント：
  ・どちらの定理を使うか、問題文の条件で判断しよう
  ・公式を丸暗記するだけでなく、使い方も練習しよう
`,
                pitfall: {
                    title: "よくある間違い：どの定理を使うべきか判断できない",
                    detail: `
与えられた情報によって、正弦定理と余弦定理のどちらを使うべきか判断に迷うことがあります。
「向かい合う辺と角のペアが分かっている」場合は正弦定理、
「2辺とその間の角」または「3辺」が分かっている場合は余弦定理を使うことが多いです。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "三角形ABCで、b=4, $\\angle B = 30^\\circ$, $\\angle A = 45^\\circ$ のとき、辺aの長さを求めなさい。",
                        answer: "$4\\sqrt{2}$",
                        hint: "正弦定理を使いましょう。",
                    },
                    {
                        question:
                            "三角形ABCで、b=3, c=5, $\\angle A = 60^\\circ$ のとき、辺aの長さを求めなさい。",
                        answer: "$\\sqrt{19}$",
                        hint: "余弦定理を使いましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "データの分析",
        steps: [
            {
                title: "代表値と散らばり",
                explanation: `
  データの「代表値」には、平均値（みんなの合計を人数で割る）、中央値（真ん中の値）、最頻値（いちばん多い値）があります。

  「散らばり」を表すには、範囲（最大-最小）、四分位範囲、分散、標準偏差などがあります。

  これらを使うと、データの全体的な傾向やバラつきが分かります。

  ポイント：
  ・平均値は外れ値に弱い、中央値は外れ値に強い
  ・いろいろな指標を使い分けて、データを正しく読み取ろう
`,
                pitfall: {
                    title: "よくある間違い：中央値と平均値の使い分け",
                    detail: `
外れ値があるデータの場合、平均値は大きく影響を受けますが、中央値は影響を受けにくいです。
データの特性を理解し、適切な代表値を選ぶことが重要です。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "データ：2, 5, 3, 8, 2 の平均値を求めなさい。",
                        answer: "$4$",
                        hint: "すべての値を足して、データの個数で割りましょう。",
                    },
                    {
                        question:
                            "データ：2, 5, 3, 8, 2 の中央値を求めなさい。",
                        answer: "$3$",
                        hint: "データを小さい順に並べ替えて、真ん中の値を見つけましょう。",
                    },
                ]),
            },
            {
                title: "相関関係",
                explanation: `
  「相関関係」とは、2つのデータの間に「一方が増えるともう一方も増える（正の相関）」「一方が増えるともう一方が減る（負の相関）」「関係がない（無相関）」といったつながりがあることです。

  散布図を描いたり、相関係数を計算したりすることで、相関の強さや向きを調べることができます。

  ポイント：
  ・相関があっても「原因」とは限らない（例：アイスの売上と水難事故）
  ・グラフや数値で関係の強さを見てみよう
`,
                pitfall: {
                    title: "よくある間違い：相関関係と因果関係の混同",
                    detail: `
相関関係があるからといって、必ずしも一方のデータがもう一方の原因になっている（因果関係がある）とは限りません。
例えば、「アイスクリームの売上と水難事故の件数に正の相関がある」というデータがあったとしても、アイスクリームが水難事故の原因ではありません。どちらも「気温が高い」という別の要因に影響されているだけです。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "以下の状況で、どのような相関関係が考えられますか？「気温が高くなると、ビールの売上が増える」",
                        answer: "正の相関",
                        hint: "一方が増えると、もう一方も増える関係です。",
                    },
                    {
                        question:
                            "以下の状況で、どのような相関関係が考えられますか？「勉強時間が増えると、ゲームをする時間が減る」",
                        answer: "負の相関",
                        hint: "一方が増えると、もう一方が減る関係です。",
                    },
                ]),
            },
        ],
    },
];

// 数学A の学習コンテンツ
const mathALessons: LearningTopic[] = [
    {
        topic: "場合の数と確率",
        steps: [
            {
                title: "順列と組み合わせ",
                explanation: `
  「順列」とは、いくつかのものを「順番に並べる」場合の数です。
  たとえば、5人から3人を選んで並べるとき、並び方が違えば別のものと数えます。
  $P(n, r)$ という記号で表します。

  「組み合わせ」とは、いくつかのものを「順番を気にせずに選ぶ」場合の数です。
  たとえば、5人から3人を選ぶとき、誰を選ぶかだけを考え、並び順は関係ありません。
  $C(n, r)$ という記号で表します。

  ポイント：
  ・順列は「並べる順番が大事」
  ・組み合わせは「順番は関係ない」
  ・問題文の「並べる」「選ぶ」に注目しよう！
`,
                pitfall: {
                    title: "よくある間違い：順列と組み合わせの混同",
                    detail: `
問題文で「並べる」「順番に」といった言葉があれば順列、「選ぶ」「グループを作る」といった言葉があれば組み合わせです。
どちらを使うべきか、慎重に判断しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "5人の中から3人を選んで1列に並べる方法は何通りありますか？",
                        answer: "$60$",
                        hint: "これは順列の計算です。",
                    },
                    {
                        question:
                            "5人の中から3人の委員を選ぶ方法は何通りありますか？",
                        answer: "$10$",
                        hint: "これは組み合わせの計算です。",
                    },
                ]),
            },
            {
                title: "確率の基本法則",
                explanation: `
  「確率」とは、ある出来事が起こる「可能性の大きさ」を表す数です。
  確率は「起こる場合の数 ÷ 全部の場合の数」で計算します。

  「和の法則」は「どちらか一方が起こる場合の数」を足し算で求めます。
  「積の法則」は「両方が同時に起こる場合の数」を掛け算で求めます。

  ポイント：
  ・確率は「全部の場合の数」をしっかり数える
  ・和の法則は「または」、積の法則は「かつ」
  ・サイコロや玉の問題でよく使うので、練習しよう！
`,
                pitfall: {
                    title: "よくある間違い：排反事象と独立事象の混同",
                    detail: `
排反事象は「同時に起こらない事象」であり、独立事象は「一方の事象が他方の事象に影響を与えない」事象です。
それぞれの定義を理解し、適切な法則を適用しないと、確率の計算を間違えてしまいます。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "1個のサイコロを投げるとき、偶数の目が出る確率を求めなさい。",
                        answer: "$\\frac{1}{2}$",
                        hint: "偶数の目はいくつありますか？",
                    },
                    {
                        question:
                            "袋の中に赤玉3個、白玉2個が入っている。この袋から玉を1個取り出し、色を確認して元に戻す。これを2回繰り返すとき、2回とも赤玉が出る確率を求めなさい。",
                        answer: "$\\frac{9}{25}$",
                        hint: "1回目と2回目は独立な事象です。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "整数の性質",
        steps: [
            {
                title: "約数と倍数",
                explanation: `
  「約数」とは、ある数を割り切ることができる整数のことです。
  たとえば、$6$ の約数は $1, 2, 3, 6$ です。

  「倍数」とは、ある数を何回か足したり掛けたりしてできる数です。
  たとえば、$3$ の倍数は $3, 6, 9, ...$ です。

  「最大公約数」は、2つ以上の数の共通の約数の中で一番大きいもの。
  「最小公倍数」は、2つ以上の数の共通の倍数の中で一番小さいものです。

  ポイント：
  ・約数は「割り切れる数」
  ・倍数は「その数で作れる数」
  ・最大公約数・最小公倍数は、分数の計算や約分でよく使います！
`,
                pitfall: {
                    title: "よくある間違い：素数と合成数の区別",
                    detail: `
素数は1とその数自身以外に約数を持たない自然数（1は含まない）です。2, 3, 5, 7などが素数です。
合成数は、素数でない自然数で1より大きいものです。
素因数分解は、約数や倍数を考える上で非常に重要です。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "12の正の約数をすべて求めなさい。",
                        answer: "$1,2,3,4,6,12$",
                        hint: "1から順に割れる数を探しましょう。",
                    },
                    {
                        question: "8と12の最大公約数を求めなさい。",
                        answer: "4",
                        hint: "共通の約数の中で一番大きいものです。",
                    },
                ]),
            },
            {
                title: "ユークリッドの互除法",
                explanation: `
  「ユークリッドの互除法」は、2つの数の最大公約数を見つける方法です。
  大きい数を小さい数で割って、余りが$0$になるまで繰り返します。
  最後に割り切れたときの数が最大公約数です。

  ポイント：
  ・割り算を何回も繰り返す
  ・余りが$0$になったら終わり
  ・計算の流れをノートに書いてみよう！
`,
                pitfall: {
                    title: "よくある間違い：計算の途中で止めてしまう",
                    detail: `
ユークリッドの互除法は、余りが$0$になるまで計算を続ける必要があります。 
途中で計算を止めてしまうと、正しい最大公約数が得られません。
また、余りの計算ミスにも注意しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "105と30の最大公約数をユークリッドの互除法で求めなさい。",
                        answer: "$15$",
                        hint: "105を30で割った余りは？",
                    },
                    {
                        question:
                            "252と198の最大公約数をユークリッドの互除法で求めなさい。",
                        answer: "$18$",
                        hint: "計算を繰り返しましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "図形の性質",
        steps: [
            {
                title: "三角形の性質 (重心、外心、内心など)",
                explanation: `
  三角形には、重心、外心、内心、垂心といった特別な点があります。
  重心：中線（頂点と対辺の中点を結ぶ線）の交点。各中線を2:1に内分します。
  外心：各辺の垂直二等分線の交点。外接円の中心です。
  内心：各内角の二等分線の交点。内接円の中心です。
`,
                pitfall: {
                    title: "よくある間違い：各点の定義の混同",
                    detail: `
重心、外心、内心、垂心のそれぞれの定義（どの線の交点か）を混同しないように注意しましょう。
また、それぞれの点が持つ性質（例：外心から各頂点までの距離は等しい）も正確に覚えましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "三角形の3つの中線が交わる点を何と呼びますか？",
                        answer: "重心",
                        hint: "中線が交わる点です。",
                    },
                    {
                        question:
                            "三角形の外接円の中心となる点を何と呼びますか？",
                        answer: "外心",
                        hint: "各辺の垂直二等分線の交点です。",
                    },
                ]),
            },
            {
                title: "円の性質 (方べきの定理など)",
                explanation: `
  円には、接線と弦の作る角の定理、方べきの定理など、様々な性質があります。
  方べきの定理は、円と直線が交わる点や接する点に関する辺の長さの関係を示す定理です。
  これらの定理は、図形問題で辺の長さや角度を求めるのに役立ちます。
`,
                pitfall: {
                    title: "よくある間違い：定理の適用条件",
                    detail: `
方べきの定理には、円の内部で交わる場合と外部で交わる場合、接線がある場合など、いくつかのパターンがあります。
それぞれの定理がどのような図形や条件で適用できるのかを正確に理解しておく必要があります。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "点Pから円に引いた接線の接点をT、点Pを通る直線が円と2点A, Bで交わるとき、成り立つ関係式を答えなさい。",
                        answer: "$PT^2 = PA・PB$",
                        hint: "方べきの定理を思い出しましょう。",
                    },
                    {
                        question:
                            "円に内接する四角形の対角の和は何度になりますか？",
                        answer: "$180$度",
                        hint: "円に内接する四角形の性質です。",
                    },
                ]),
            },
        ],
    },
];

// 数学II の学習コンテンツ
const math2Lessons: LearningTopic[] = [
    {
        topic: "式と証明",
        steps: [
            {
                title: "整式の除法と分数式",
                explanation: `
  「整式の除法」とは、xの式（多項式）を別の多項式で割る計算です。
  筆算のように、次数（xの何乗か）をそろえて計算します。

  「分数式」は、分母や分子にxの式がある分数のことです。
  分母・分子を同じ式で割ったり、通分したりして計算します。

  ポイント：
  ・割り算は筆算のイメージで
  ・分数式は通分や約分をしっかり
`,
                pitfall: {
                    title: "よくある間違い：整式の除法の筆算ミス",
                    detail: `
整式の除法では、各項の次数を揃えて計算すること、引き算の符号ミスに注意が必要です。
分数式では、通分する際に分母・分子に同じものを掛けること、約分する際に共通因数で割ることなどを忘れないようにしましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "$(x^2 + 3x + 2)$ を $(x+1)$ で割ると、商は $x+2$、余りは $0$ です。",
                        answer: "商: $x^2-x+2$, 余り: $1$",
                        hint: "筆算で計算してみましょう。",
                    },
                    {
                        question:
                            "$\\frac{1}{x} + \\frac{1}{x+1} = \\frac{x+1}{x(x+1)} + \\frac{x}{x(x+1)} = \\frac{2x+1}{x(x+1)}$",
                        answer: "$2x/(x^2-1)$",
                        hint: "通分しましょう。",
                    },
                ]),
            },
            {
                title: "恒等式と等式・不等式の証明",
                explanation: `
  「恒等式」とは、どんなxを入れても必ず成り立つ式のことです。
  たとえば、x(x+1) = x^2 + x のような式です。

  等式や不等式の証明では、
  ・片方の式を変形してもう一方と同じにする
  ・両辺をそれぞれ変形して同じ式にする
  などの方法があります。

  不等式の証明では、$(A-B)$ が $0$ 以上になることを示したり、平均の性質を使ったりします。

  ポイント：
  ・恒等式は「いつでも成り立つ」式
  ・証明は式変形の練習！
`,
                pitfall: {
                    title: "よくある間違い：恒等式と方程式の混同",
                    detail: `
恒等式は「常に成り立つ」式であり、方程式は「特定の文字の値で成り立つ」式です。
恒等式の証明では、係数比較法や数値代入法が有効です。
不等式の証明では、二乗の形や正負の判断が重要になります。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "次の等式が恒等式となるように、定数a, bの値を求めなさい。$(a+b)x + (a-b) = 4x - 2$",
                        answer: "$a=1, b=3$",
                        hint: "係数比較法を使いましょう。",
                    },
                    {
                        question:
                            "$a>0, b>0$ のとき、$\\frac{a+b}{2} \\ge \\sqrt{ab}$ を証明しなさい。",
                        answer: `
1. まず、$\\frac{a+b}{2} - \\sqrt{ab}$ が0以上であることを示します。
   \\[
   \\frac{a+b}{2} - \\sqrt{ab} = \\frac{a+b - 2\\sqrt{ab}}{2}
   \\]
2. 分子 $a+b - 2\\sqrt{ab}$ を変形します。ここで、$a = (\\sqrt{a})^2$、$b = (\\sqrt{b})^2$ と考えると、分子は以下のように書き換えられます。
   \\[
   a+b - 2\\sqrt{ab} = (\\sqrt{a})^2 - 2\\sqrt{a}\\sqrt{b} + (\\sqrt{b})^2
   \\]
3. これは、$(x-y)^2 = x^2 - 2xy + y^2$ の形をしているため、次のように因数分解できます。
   \\[
   (\\sqrt{a})^2 - 2\\sqrt{a}\\sqrt{b} + (\\sqrt{b})^2 = (\\sqrt{a} - \\sqrt{b})^2
   \\]
4. したがって、元の式は以下のようになります。
   \\[
   \\frac{a+b}{2} - \\sqrt{ab} = \\frac{(\\sqrt{a} - \\sqrt{b})^2}{2}
   \\]
5. 実数である$\\sqrt{a}$と$\\sqrt{b}$に対して、$(\\sqrt{a} - \\sqrt{b})^2$ は**常に0以上**です。また、分母の2は正の数です。よって、
   \\[
   \\frac{(\\sqrt{a} - \\sqrt{b})^2}{2} \\ge 0
   \\]
   が成り立ちます。
6. これにより、$\\frac{a+b}{2} - \\sqrt{ab} \\ge 0$ となり、$\\frac{a+b}{2} \\ge \\sqrt{ab}$ が証明されました。

**等号成立条件**
等号が成立するのは、$\\frac{(\\sqrt{a} - \\sqrt{b})^2}{2} = 0$ のとき、すなわち $(\\sqrt{a} - \\sqrt{b})^2 = 0$ のときです。
これは $\\sqrt{a} - \\sqrt{b} = 0$、つまり $\\sqrt{a} = \\sqrt{b}$ のときであり、**$a=b$** のときに限られます。
`,
                        hint: "両辺を二乗して差を考えてみましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "高次方程式",
        steps: [
            {
                title: "複素数と2次方程式の解",
                explanation: `
  「複素数」とは、実数では解けない方程式（例：$x^2+1=0$）を解くために考えられた新しい数です。
  虚数単位 $i$（$i^2=-1$）を使って、$a+bi$ の形で表します。

  2次方程式の解は、判別式がマイナスでも複素数の範囲で2つ出せます。

  ポイント：
  ・$i^2 = -1$ をしっかり覚えよう
  ・複素数は「実数＋虚数」の形
`,
                pitfall: {
                    title: "よくある間違い：虚数単位の計算ミス",
                    detail: `
$i^2 = -1$ であることを常に意識しましょう。
複素数の足し算・引き算は実部と虚部をそれぞれ計算し、掛け算は分配法則で展開してから $i^2 = -1$ を適用します。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "(2+3i) + (1-i)$ を計算しなさい。",
                        answer: "$3+2i$",
                        hint: "実部と虚部をそれぞれ足し合わせましょう。",
                    },
                    {
                        question: "(1+i)^2$ を計算しなさい。",
                        answer: "$2i$",
                        hint: "展開してから $i^2 = -1$ を使いましょう。",
                    },
                ]),
            },
            {
                title: "因数定理と高次方程式",
                explanation: `
  「因数定理」は、多項式 $P(x)$ が $(x-k)$ で割り切れるとき、$P(k)=0$ になるという定理です。
  これを使うと、3次や4次など高い次数の方程式の解を見つけやすくなります。

  $P(k)=0$ になる $k$ を見つけたら、$(x-k)$ で割って次数を下げていきます。

  ポイント：
  ・定数項の約数を代入してみると効率的
  ・割り算と因数分解を組み合わせて使う
`,
                pitfall: {
                    title: "よくある間違い：試行錯誤の範囲",
                    detail: `
$P(k)=0$ となる $k$ を見つける際、闇雲に数を代入するのではなく、定数項の約数を試すのが効率的です。
例えば、$x^3 + ax^2 + bx + c = 0$ の場合、$c$ の約数（正負両方）を試してみましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "多項式 $P(x) = x^3 - 2x^2 - 5x + 6$ が $x-1$ で割り切れるか調べなさい。",
                        answer: "割り切れる",
                        hint: "$P(1)$ の値を計算してみましょう。",
                    },
                    {
                        question:
                            "方程式 $x^3 - 3x^2 + 4 = 0$ の解を求めなさい。",
                        answer: "$x=-1,2$（重解）",
                        hint: "定数項4の約数から解を探し、因数分解しましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "図形と方程式",
        steps: [
            {
                title: "点と直線",
                explanation: `
  「点と直線」の問題では、座標平面上の2点間の距離や、直線の傾き・方程式を学びます。
  2点間の距離は「三平方の定理」を使って計算します。

  直線の方程式には、$y=mx+n$（傾きと切片）や、$y-y1=m(x-x1)$（点と傾き）などいろいろな形があります。

  ポイント：
  ・距離は「三平方の定理」
  ・傾きは「$y$ の変化÷$x$ の変化」
  ・直線の式の形を覚えよう
`,
                pitfall: {
                    title: "よくある間違い：傾きの計算ミス",
                    detail: `
傾きは $\\frac{yの変化量}{xの変化量}$ です。
計算の際、分子と分母の引き算の順序を間違えないように注意しましょう。
また、垂直な2直線の傾きの積は $-1$ になる性質も重要です。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "点A$(1,2)$ と点B$(4,6)$ の間の距離を求めなさい。",
                        answer: "$5$",
                        hint: "距離の公式を使いましょう。",
                    },
                    {
                        question:
                            "点$(2,3)$ を通り、傾きが $-2$ の直線の方程式を求めなさい。",
                        answer: "$y=-2x+7$",
                        hint: "点と傾きが分かっている直線の方程式の形を思い出しましょう。",
                    },
                ]),
            },
            {
                title: "円の方程式",
                explanation: `
  「円の方程式」は、中心と半径が分かれば $(x-a)^2+(y-b)^2=r^2$ の形で表せます。
  これは「中心からの距離が常に半径 $r$」という意味です。

  一般形（$x^2+y^2+lx+my+n=0$）は、平方完成して標準形に直すと中心と半径が分かります。

  ポイント：
  ・標準形の形を覚えよう
  ・平方完成で中心と半径を求める
`,
                pitfall: {
                    title: "よくある間違い：半径の二乗を忘れる",
                    detail: `
円の方程式の右辺は半径 $r$ ではなく $r^2$ です。
例えば、半径が3の円の方程式は $(x-a)^2 + (y-b)^2 = 9$ となります。
また、中心の座標の符号ミスにも注意しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "中心が $(1, -2)$、半径が $4$ の円の方程式を求めなさい。",
                        answer: "$(x-1)^2+(y+2)^2=16$",
                        hint: "円の方程式の標準形に当てはめましょう。",
                    },
                    {
                        question:
                            "方程式 $x^2 + y^2 - 6x + 2y + 6 = 0$ が表す円の中心の座標と半径を求めなさい。",
                        answer: "中心:$(3,-1)$, 半径:$2$",
                        hint: "平方完成して標準形に変形しましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "三角関数",
        steps: [
            {
                title: "三角関数の定義とグラフ",
                explanation: `
  「三角関数」は、単位円（半径 $1$ の円）を使って、角度と $x$・$y$ の関係を表す関数です。
  $\\sin \\theta$ は $y$ 座標、$\\cos \\theta$ は $x$ 座標、$\\tan \\theta$ は傾きとして考えられます。

  これらの関数は、一定の間隔で同じ形が繰り返される「周期的なグラフ」になります。

  ポイント：
  ・単位円でイメージしよう
  ・グラフの周期性に注目
`,
                pitfall: {
                    title: "よくある間違い：符号の取り違え",
                    detail: `
単位円のどの象限に角度があるかによって、$\\sin \\theta$, $\\cos \\theta$, $\\tan \\theta$ の符号が変わります。
これを間違えると、計算結果が大きく変わってしまいます。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$\\sin(\\frac{\\pi}{2})$ の値を求めなさい。",
                        answer: "$1$",
                        hint: "単位円上の点 $(0,1)$ を考えましょう。",
                    },
                    {
                        question: "関数 $y = \\sin x$ の周期を答えなさい。",
                        answer: "$2\\pi$",
                        hint: "グラフが繰り返される最小の区間です。",
                    },
                ]),
            },
            {
                title: "加法定理",
                explanation: `
  「加法定理」は、2つの角度の和や差の三角関数を、$\\sin$ や $\\cos$ で表す公式です。
  たとえば、$\\sin(\\alpha + \\beta)$ や $\\cos(\\alpha + \\beta)$ など。

  これを使うと、複雑な三角関数の計算や、倍角・半角の公式も導けます。

  ポイント：
  ・公式の形をしっかり覚えよう
  ・符号や $\\sin$ ・ $\\cos$ の組み合わせに注意
`,
                pitfall: {
                    title: "よくある間違い：符号や関数の混同",
                    detail: `
加法定理は公式が似ているため、符号や$\\sin$と$\\cos$の組み合わせを間違えやすいです。
語呂合わせ（例：「咲いたコスモス、コスモス咲いた」）などを活用して正確に覚えましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "$\\sin(75^\\circ)$ の値を求めなさい。（ヒント：$75^\\circ = 45^\\circ + 30^\\circ$）",
                        answer: "$\\frac{\\sqrt{6}+\\sqrt{2}}{4}$",
                        hint: "$\\sin(\\alpha + \\beta)$ の公式を使います。",
                    },
                    {
                        question:
                            "$\\cos(15^\\circ)$ の値を求めなさい。（ヒント：$15^\\circ = 45^\\circ - 30^\\circ$）",
                        answer: "$\\frac{\\sqrt{6}+\\sqrt{2}}{4}$",
                        hint: "$\\cos(\\alpha - \\beta)$ の公式を使います。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "指数関数と対数関数",
        steps: [
            {
                title: "指数関数",
                explanation: `
  「指数関数」は、$y=a^x$ の形の関数です。
  $a$ が $1$ より大きいと右上がり、$0$ より小さいと右下がりのグラフになります。

  計算には「指数法則」（$a^m \\times a^n = a^{m+n}$ など）を使います。

  ポイント：
  ・指数法則をしっかり覚えよう
  ・グラフの形（増加・減少）をイメージ
`,
                pitfall: {
                    title: "よくある間違い：指数法則の適用ミス",
                    detail: `
特に、$(a^m)^n = a^{mn}$ と $a^m a^n = a^{m+n}$ の使い分けを間違えやすいです。
また、負の指数 ($a^{-n} = \\frac{1}{a^n}$) や分数指数 ($a^{\\frac{1}{n}} = \\sqrt[n]{a}$) の計算も重要です。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$2^3 \\times 2^4$ を計算しなさい。",
                        answer: "$128$",
                        hint: "指数法則 $a^m a^n = a^{m+n}$ を使いましょう。",
                    },
                    {
                        question: "$(3^2)^3$ を計算しなさい。",
                        answer: "$729$",
                        hint: "指数法則 $(a^m)^n = a^{mn}$ を使いましょう。",
                    },
                ]),
            },
            {
                title: "対数関数",
                explanation: `
  「対数関数」は、指数関数の逆で「$a$ を何回かけたら $x$ になるか」を表す関数です。
  たとえば、$\\log_2 8=3$ は「$2$ を $3$ 回かけると $8$ になる」という意味です。

  計算には「対数法則」（足し算が掛け算、引き算が割り算になるなど）を使います。

  ポイント：
  ・対数の意味をイメージしよう
  ・法則を使いこなすと計算が楽になる
`,
                pitfall: {
                    title: "よくある間違い：対数の定義と法則の混同",
                    detail: `
対数の定義（例：$\\log_2 8 = 3$ は $2^3 = 8$ を意味する）をしっかり理解することが重要です。
対数法則の適用も、足し算が掛け算に、引き算が割り算になるなど、指数法則と逆の関係にあることを意識しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$\\log_2 8$ の値を求めなさい。",
                        answer: "$3$",
                        hint: "2を何乗したら8になりますか？",
                    },
                    {
                        question:
                            "$\\log_{10} 2 + \\log_{10} 5$ を計算しなさい。",
                        answer: "$1$",
                        hint: "対数法則 $\\log_a M + \\log_a N = \\log_a MN$ を使いましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "微分法と積分法", // 数学IIの範囲での基本的な微分積分
        steps: [
            {
                title: "導関数 (基本的な多項式)",
                explanation: `
  「導関数」とは、関数の「変化の割合（傾き）」を表す新しい関数です。
  $x^n$ の微分は「$n$ を前に出して、$x$ の指数を1つ下げる」ルールで計算します。

  導関数を使うと、グラフの傾きや接線の式が分かります。

  ポイント：
  ・微分の公式を覚えよう
  ・導関数は「傾きの関数」
`,
                pitfall: {
                    title: "よくある間違い：定数項の微分",
                    detail: `
定数項（例：$x^2+5$ の $5$）を微分すると $0$ になります。
これを $1$ と間違えてしまうことが多いので注意しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "関数 $f(x) = x^3 - 4x^2 + 2x - 1$ を微分しなさい。",
                        answer: "$3x^2 - 8x + 2$",
                        hint: "各項を個別に微分しましょう。",
                    },
                    {
                        question: "関数 $g(x) = 5x^2 + 3$ を微分しなさい。",
                        answer: "$10x$",
                        hint: "定数項の微分に注意しましょう。",
                    },
                ]),
            },
            {
                title: "接線の方程式 (多項式)",
                explanation: `
  「接線の方程式」は、グラフ上のある点での「接する直線」の式です。
  まず導関数で傾きを求め、その点の座標と合わせて直線の式を作ります。

  $y-f(a)=f'(a)(x-a)$ の形を覚えておくと便利です。

  ポイント：
  ・傾きは導関数で求める
  ・点の座標と組み合わせて直線の式に
`,
                pitfall: {
                    title: "よくある間違い：接線の傾きと方程式の混同",
                    detail: `
$f'(a)$ は接線の「傾き」であり、方程式そのものではありません。
方程式を求める際には、点 $(a, f(a))$ も利用して、直線の式を完成させる必要があります。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "関数 $y = x^2 + 2x$ の $x=1$ における接線の方程式を求めなさい。",
                        answer: "$y=4x-1$",
                        hint: "まず$f'(x)$と$f'(1)$を求め、点$(1, f(1))$を通る直線を考えましょう。",
                    },
                    {
                        question:
                            "関数 $y = x^3 - 3x$ の $x=0$ における接線の方程式を求めなさい。",
                        answer: "$y=-3x$",
                        hint: "同様に$f'(x)$と$f'(0)$を求め、点$(0, f(0))$を通る直線を考えましょう。",
                    },
                ]),
            },
            {
                title: "不定積分 (基本的な多項式)",
                explanation: `
  「不定積分」とは、関数を「逆にたどる」計算です。
  $x^n$ の積分は「指数を1つ増やして、その数で割る」ルールで計算します。

  最後に「+C（積分定数）」を必ずつけましょう。

  ポイント：
  ・積分の公式を覚えよう
  ・+Cを忘れずに！
`,
                pitfall: {
                    title: "よくある間違い：積分定数Cの忘れ",
                    detail: `
不定積分では、積分定数 $C$ をつけ忘れると不正解になります。
これは、微分すると定数が消えてしまうため、元の関数にどのような定数があったか分からないからです。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$\\int (2x + 3) dx$ を求めなさい。",
                        answer: "$x^2+3x+C$",
                        hint: "各項を個別に積分し、積分定数Cをつけましょう。",
                    },
                    {
                        question: "$\\int (x^2 - 5x + 4) dx$ を求めなさい。",
                        answer: "$\\frac{1}{3} x^3 - \\frac{5}{2} x^2 + 4x + C$",
                        hint: "それぞれの項の指数に1を足し、その数で割りましょう。",
                    },
                ]),
            },
            {
                title: "定積分と面積 (多項式)",
                explanation: `
  「定積分」は、関数と $x$ 軸で囲まれた部分の「面積」を求める計算です。
  上端と下端の値を代入して引き算します。

  x軸より下の部分はマイナスになるので、面積を出すときは絶対値をとるか、符号に注意しましょう。

  ポイント：
  ・定積分は「面積」
  ・上端-下端で計算
  ・符号や絶対値に注意
`,
                pitfall: {
                    title: "よくある間違い：x軸より下の面積の符号",
                    detail: `
面積は常に正の値です。関数がx軸の下にある区間では、定積分の値は負になります。
この場合、その区間の定積分の値に絶対値をつけるか、$-f(x)$ を積分するようにしましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$\\int_0^2 (x^2) dx$ を計算しなさい。",
                        answer: "$\\frac{8}{3}$",
                        hint: "まず不定積分を求め、その後で上端と下端の値を代入して引き算します。",
                    },
                    {
                        question:
                            "曲線 $y = x^2 - 1$ と $x$軸で囲まれた部分の面積を求めなさい。",
                        answer: "$\\frac{4}{3}$",
                        hint: "x軸との交点を求め、その区間で積分します。x軸より下の部分の符号に注意。",
                    },
                ]),
            },
        ],
    },
];

// 数学B の学習コンテンツ
const mathBLessons: LearningTopic[] = [
    {
        topic: "数列",
        steps: [
            {
                title: "等差数列と等比数列",
                explanation: `
  「等差数列」とは、となり合う項の差がいつも同じ数列です。
  たとえば、$1, 3, 5, 7, ...$ のように、毎回同じ数だけ増えていきます。
  一般項は $a_n = a_1 + (n-1)d$ で表します。

  「等比数列」とは、となり合う項の比（わり算の結果）がいつも同じ数列です。
  たとえば、$2, 6, 18, 54, ...$ のように、毎回同じ数をかけていきます。
  一般項は $a_n = a_1 r^{n-1}$ で表します。

  ポイント：
  ・等差数列は「足し算・引き算」
  ・等比数列は「かけ算・わり算」
  ・公式の形をしっかり覚えよう！
`,
                pitfall: {
                    title: "よくある間違い：一般項の公式の混同",
                    detail: `
等差数列と等比数列の一般項の公式を混同しないように注意しましょう。
特に、等比数列の公比 $r$ の指数が $n-1$ であることを忘れないようにしましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "初項3、公差2の等差数列の第5項を求めなさい。",
                        answer: "$11$",
                        hint: "等差数列の一般項の公式に当てはめましょう。",
                    },
                    {
                        question: "初項2、公比3の等比数列の第4項を求めなさい。",
                        answer: "54",
                        hint: "等比数列の一般項の公式に当てはめましょう。",
                    },
                ]),
            },
            {
                title: "数列の和 (Σ記号)",
                explanation: `
  数列の各項を足し合わせたものを数列の和と呼び、Σ（シグマ）記号を使って表します。
  等差数列の和の公式：$S_n = \\frac{n(a_1 + a_n)}{2}$ または $S_n = \\frac{n(2a_1 + (n-1)d)}{2}$
  等比数列の和の公式：$S_n = \\frac{a_1(r^n - 1)}{r-1}$ （$r \\neq 1$ のとき）
  Σ記号の計算では、公式や性質を正しく適用することが重要です。
`,
                pitfall: {
                    title: "よくある間違い：Σ記号の範囲と変数",
                    detail: `
Σ記号の上下に書かれている添字の範囲を正確に把握しましょう。
また、Σ記号の右にある式が、どの変数（例：$k$）に依存しているかを確認し、それ以外の文字は定数として扱うことに注意しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "初項1、末項10、項数10の等差数列の和を求めなさい。",
                        answer: "$55$",
                        hint: "等差数列の和の公式を使いましょう。",
                    },
                    {
                        question: "$\\sum_{k=1}^{n} k$ の公式を答えなさい。",
                        answer: "$\\frac{n(n+1)}{2}$",
                        hint: "自然数の和の公式です。",
                    },
                ]),
            },
            {
                title: "漸化式",
                explanation: `
  「漸化式」とは、数列の各項を、その前の項やいくつかの前の項を使って表す式です。
  例えば、等差数列は $a_{n+1} = a_n + d$、等比数列は $a_{n+1} = r a_n$ と表せます。
  漸化式を解くことで、数列の一般項を求めることができます。
`,
                pitfall: {
                    title: "よくある間違い：漸化式のタイプの見分け方",
                    detail: `
漸化式にはいくつかの典型的なパターン（等差型、等比型、特性方程式を用いるものなど）があります。
与えられた漸化式がどのタイプに当てはまるかを見分け、適切な解法を適用することが重要です。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "$a_1 = 1, a_{n+1} = a_n + 3$ で定義される数列の一般項 $a_n$ を求めなさい。",
                        answer: "$3n-2$",
                        hint: "これは等差数列の漸化式です。",
                    },
                    {
                        question:
                            "$a_1 = 2, a_{n+1} = 2a_n$ で定義される数列の一般項 $a_n$ を求めなさい。",
                        answer: "$2^n$",
                        hint: "これは等比数列の漸化式です。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "ベクトル",
        steps: [
            {
                title: "ベクトルの演算",
                explanation: `
  ベクトルは、向きと大きさを持つ量です。
  ベクトルの足し算は、平行四辺形の法則や三角形の法則で表せます。
  実数倍は、ベクトルの大きさを変えたり、向きを反転させたりします。
  成分表示されたベクトルは、各成分ごとに足し算や実数倍の計算を行います。
`,
                pitfall: {
                    title: "よくある間違い：ベクトルの足し算と引き算の向き",
                    detail: `
ベクトル $\\vec{a} + \\vec{b}$ は、$\\vec{a}$ の終点から $\\vec{b}$ を始める形です。
ベクトル $\\vec{a} - \\vec{b}$ は、$\\vec{b}$ の始点から $\\vec{a}$ の始点へ向かうベクトルと等しいです。
図で確認しながら、向きを間違えないようにしましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "$\\vec{a} = (2, 1)$, $\\vec{b} = (3, -2)$ のとき、$\\vec{a} + \\vec{b}$ を求めなさい。",
                        answer: "$(5,-1)$",
                        hint: "各成分を足し合わせましょう。",
                    },
                    {
                        question:
                            "$\\vec{a} = (1, 4)$ のとき、$3\\vec{a}$ を求めなさい。",
                        answer: "$(3,12)$",
                        hint: "各成分を3倍しましょう。",
                    },
                ]),
            },
            {
                title: "平面ベクトル",
                explanation: `
  平面ベクトルは、2次元の座標平面上で考えられるベクトルです。
  内積は、2つのベクトルのなす角や垂直条件を調べるのに使われます。
  $\\vec{a} \\cdot \\vec{b} = |\\vec{a}||\\vec{b}|\\cos \\theta$ または 成分で $\\vec{a} \\cdot \\vec{b} = a_x b_x + a_y b_y$ です。
  内積が0ならば、2つのベクトルは垂直です。
`,
                pitfall: {
                    title: "よくある間違い：内積とベクトルの積",
                    detail: `
内積はスカラー（数値）になる演算であり、ベクトルになるわけではありません。
ベクトルの積には、内積の他に外積（高校数学では扱わない）がありますが、混同しないようにしましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "$\\vec{a} = (1, 2)$, $\\vec{b} = (3, -1)$ のとき、内積 $\\vec{a} \\cdot \\vec{b}$ を求めなさい。",
                        answer: "$1$",
                        hint: "成分同士を掛けて足し合わせましょう。",
                    },
                    {
                        question:
                            "2つのベクトル $\\vec{a} = (2, k)$, $\\vec{b} = (3, 6)$ が垂直であるとき、定数kの値を求めなさい。",
                        answer: "$-1$",
                        hint: "内積が0になる条件を使いましょう。",
                    },
                ]),
            },
            {
                title: "空間ベクトル",
                explanation: `
  空間ベクトルは、3次元の空間で考えられるベクトルです。
  平面ベクトルと同様に、足し算、実数倍、内積などの演算が可能です。
  成分表示は $(x, y, z)$ のように3つの成分を持ちます。
  空間座標における点や直線の位置関係をベクトルで表現できます。
`,
                pitfall: {
                    title: "よくある間違い：空間のイメージ不足",
                    detail: `
空間ベクトルを扱う際には、3次元空間での位置関係や方向を正確にイメージすることが重要です。
特に、図形的な問題を解く際には、座標軸を意識した図を描く練習をしましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "点A$(1,2,3)$ と点B$(4,0,1)$ のとき、ベクトル $\\vec{AB}$ の成分を求めなさい。",
                        answer: "$(3,-2,-2)$",
                        hint: "終点の成分から始点の成分を引きましょう。",
                    },
                    {
                        question:
                            "ベクトル $\\vec{a} = (1, -1, 2)$ の大きさを求めなさい。",
                        answer: "$\\sqrt{6}$",
                        hint: "各成分の二乗の和の平方根です。",
                    },
                ]),
            },
        ],
    },
];

// 数学III の学習コンテンツ (既存の微分積分コンテンツを再利用・一部追加)
const math3Lessons: LearningTopic[] = [
    {
        topic: "複素数平面",
        steps: [
            {
                title: "複素数と複素数平面",
                explanation: `
  「複素数」とは、$a+bi$ の形で表す数で、$a$ は実数、$bi$ は虚数です。
  複素数平面（ガウス平面）は、横軸が実数、縦軸が虚数として複素数を点で表します。
  複素数のたし算・ひき算は、ベクトルのように考えると分かりやすいです。

  ポイント：
  ・複素数は「実部＋虚部」
  ・平面上の点としてイメージしよう
`,
                pitfall: {
                    title: "よくある間違い：虚数と複素数の混同",
                    detail: `
虚数単位 $i$ を含む数を虚数と呼びますが、複素数 $a+bi$ のうち $b \\neq 0$ のものが虚数です。
$a=0$ の場合は純虚数と呼びます。
複素数平面上での点の位置と、その複素数の実部・虚部の対応を正確に理解しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "複素数 $3+4i$ を複素数平面上に図示しなさい。",
                        answer: "実軸$3$, 虚軸$4$ の点",
                        hint: "実部がx座標、虚部がy座標に対応します。",
                    },
                    {
                        question:
                            "複素数 $z = 1 + \\sqrt{3}i$ の絶対値 $|z|$ を求めなさい。",
                        answer: "$2$",
                        hint: "原点からの距離です。三平方の定理を使いましょう。",
                    },
                ]),
            },
            {
                title: "ド・モアブルの定理",
                explanation: `
  複素数を極形式 $z = r(\\cos \\theta + i \\sin \\theta)$ で表すと、
  $z^n = r^n (\\cos n\\theta + i \\sin n\\theta)$ という関係が成り立ちます。これがド・モアブルの定理です。
  この定理を使うと、複素数の累乗や、複素数の方程式の解を簡単に求めることができます。
`,
                pitfall: {
                    title: "よくある間違い：角度の計算ミス",
                    detail: `
ド・モアブルの定理を適用する際、角度 $\\theta$ を $n$ 倍することになります。
このとき、角度が $2\\pi$（または $360^\\circ$）を超える場合は、その周期性を考慮して角度を調整しましょう。
また、極形式への変換を正確に行うことが前提となります。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "$(\\cos \\theta + i \\sin \\theta)^3$ を計算しなさい。",
                        answer: "$\\cos(3\\theta)+i\\sin(3\\theta)$",
                        hint: "ド・モアブルの定理をそのまま適用しましょう。",
                    },
                    {
                        question: "$(1+i)^4$ を計算しなさい。",
                        answer: "$-4$",
                        hint: "まず $1+i$ を極形式に直し、その後ド・モアブルの定理を適用しましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "関数",
        steps: [
            {
                title: "いろいろな関数 (分数関数、無理関数など)",
                explanation: `
  数学IIIでは、分数関数 ($y = \\frac{P(x)}{Q(x)}$)、無理関数 ($y = \\sqrt{f(x)}$)、指数関数、対数関数、三角関数など、様々な種類の関数を学びます。
  それぞれの関数の定義域、値域、グラフの概形、漸近線などを理解することが重要です。
`,
                pitfall: {
                    title: "よくある間違い：定義域の確認不足",
                    detail: `
分数関数では分母が0になる点、無理関数では根号の中が負になる点など、関数が定義されない範囲があります。
これらの定義域を正確に把握しないと、グラフを描いたり、極限や微分を計算する際に間違いが生じます。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "関数 $y = \\frac{1}{x}$ の漸近線を求めなさい。",
                        answer: "$x=2, y=0$",
                        hint: "分母が0になる点と、xが無限大に近づくときのyの値を考えましょう。",
                    },
                    {
                        question:
                            "関数 $y = \\sqrt{x+1}$ の定義域を求めなさい。",
                        answer: "$x>=-1$",
                        hint: "根号の中は負にならないという条件を考えましょう。",
                    },
                ]),
            },
            {
                title: "逆関数と合成関数",
                explanation: `
  逆関数は、元の関数のxとyの役割を入れ替えた関数です。$y=f(x)$ の逆関数は $x=f(y)$ をyについて解いたものです。記号では $f^{-1}(x)$ と書きます。
  合成関数は、ある関数の結果を別の関数の入力として使う関数です。$f(g(x))$ や $g(f(x))$ のように表されます。
`,
                pitfall: {
                    title: "よくある間違い：逆関数の存在条件",
                    detail: `
逆関数が存在するのは、元の関数が1対1の対応である（単調増加または単調減少）場合のみです。
例えば、$y=x^2$ は逆関数を持ちません（定義域を制限すれば持つ）。
合成関数の順序も重要で、$f(g(x))$ と $g(f(x))$ は一般に異なります。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "関数 $y = 2x - 1$ の逆関数を求めなさい。",
                        answer: "$y=\\frac{1}{2}x+\\frac{1}{2}$",
                        hint: "xとyを入れ替えてyについて解きましょう。",
                    },
                    {
                        question:
                            "関数 $f(x) = x+1$, $g(x) = x^2$ のとき、$f(g(x))$ を求めなさい。",
                        answer: "$x^2+1$",
                        hint: "$g(x)$ を $f(x)$ のxに代入しましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "極限", // トピック名
        steps: [
            {
                title: "極限の概念と表記", // ステップのタイトル
                explanation: `
  極限とは、関数がある値に限りなく近づくときの関数の値の振る舞いを表すものです。例えば、$x$が2に近づくとき、$x+1$は3に近づきます。これを$\\lim_{x \\to 2} (x+1) = 3$と表記します。
  「限りなく近づく」というのは、その値そのものになるわけではない、という点が重要です。
`,
                pitfall: {
                    // よくある間違いのセクション
                    title: "よくある間違い：極限と代入を混同する",
                    detail: `
極限は「限りなく近づく」ことであり、その値を「代入する」こととは異なります。
例えば、$\\lim_{x \\to 0} \\frac{x^2}{x}$ の場合、単純に$x=0$を代入すると$\\frac{0}{0}$となり計算できません。
しかし、この式は$x \\neq 0$のとき$\\frac{x^2}{x} = x$と簡略化できるため、$\\lim_{x \\to 0} x = 0$となります。
これは、$x$が0に限りなく近づくとき、関数$\\frac{x^2}{x}$の値は0に限りなく近づく、という意味です。
`,
                },
                problems: normalizeProblems([
                    // 練習問題
                    {
                        question:
                            "$\\lim_{x \\to 3} (2x - 1)$ の値を求めなさい。",
                        answer: "$5$",
                        hint: "関数に$x$の値を代入してみてください。",
                    },
                    {
                        question:
                            "$\\lim_{x \\to 1} (x^2 + 4)$ の値を求めなさい。",
                        answer: "$5$",
                        hint: "これも単純な代入で解けます。",
                    },
                ]),
            },
            {
                title: "極限の計算（多項式関数）",
                explanation: `
  多項式関数の極限は、基本的に$x$が近づく値を関数に代入することで求められます。
  例えば、$\\lim_{x \\to a} P(x) = P(a)$ となります。
`,
                pitfall: {
                    title: "よくある間違い：無限大の扱い",
                    detail: `
$x \\to \\infty$ (無限大) の極限を考える場合、単純な代入はできません。
例えば、$\\lim_{x \\to \\infty} (x^2 - x)$ の場合、$x^2$の方が$x$よりも速く増加するため、結果は$\\infty$となります。
最高次の項に注目するのがポイントです。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "$\\lim_{x \\to -2} (x^3 + 3x - 5)$ の値を求めなさい。",
                        answer: "$-19$",
                        hint: "多項式関数なので、直接代入して計算できます。",
                    },
                    {
                        question:
                            "$\\lim_{x \\to \\infty} (x^2 - 5x + 1)$ の値を求めなさい。",
                        answer: "$\\infty$", // 無限大は文字列として扱う
                        hint: "最高次の項の振る舞いを考えると良いでしょう。",
                    },
                ]),
            },
            {
                title: "極限の計算（分数関数）",
                explanation: `
  分数関数の極限では、分母が$0$になる場合に注意が必要です。
  分母が0になる場合、因数分解や有理化などの操作で式を簡略化してから極限を計算します。
`,
                pitfall: {
                    title: "よくある間違い：約分せずに代入する",
                    detail: `
$\\lim_{x \\to 2} \\frac{x^2 - 4}{x - 2}$ のような問題で、約分せずに$x=2$を代入すると$\\frac{0}{0}$となり、計算できません。
この場合、分子を因数分解して$\\frac{(x-2)(x+2)}{x-2}$とし、$x \\neq 2$のときに約分すると$x+2$になります。
したがって、$\\lim_{x \\to 2} (x+2) = 4$となります。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "$\\lim_{x \\to 1} \\frac{x^2 - 1}{x - 1}$ の値を求めなさい。",
                        answer: "$2$",
                        hint: "分子を因数分解して約分できます。",
                    },
                    {
                        question:
                            "$\\lim_{x \\to 0} \\frac{\\sqrt{x+1} - 1}{x}$ の値を求めなさい。（ヒント：有理化）",
                        answer: "$0.5$",
                        hint: "分母の有理化を試みてください。",
                    },
                ]),
            },
            {
                title: "関数の連続性",
                explanation: `
  関数$f(x)$が$x=a$で連続であるとは、以下の3つの条件が満たされることです。
  1. $f(a)$が存在する。
  2. $\\lim_{x \\to a} f(x)$が存在する。
  3. $\\lim_{x \\to a} f(x) = f(a)$ である。
  簡単に言えば、グラフが途切れていない状態です。
`,
                pitfall: {
                    title: "よくある間違い：グラフが途切れていれば不連続",
                    detail: `
連続性の定義は3つの条件全てを満たす必要があります。
例えば、関数が$x=a$で定義されていても、その点での極限値が存在しない場合や、極限値と関数値が一致しない場合は不連続です。
穴が開いているグラフや、ジャンプしているグラフは不連続です。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "関数 $f(x) = \\begin{cases} x+2 & (x \\neq 1) \\\\ 5 & (x = 1) \\end{cases}$ は $x=1$ で連続ですか？",
                        answer: "不連続",
                        hint: "xが1に近づくときの極限値と、x=1での関数値が一致するか確認しましょう。",
                    },
                    {
                        question:
                            "関数 $g(x) = x^2 - 3x + 2$ は全ての点で連続ですか？",
                        answer: "連続",
                        hint: "多項式関数は常に連続であることを思い出してください。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "微分", // トピック名
        steps: [
            {
                title: "微分の定義と導関数",
                explanation: `
  微分とは、関数の変化の割合、つまり「傾き」を求めることです。
  特に、ある点における接線の傾きを求める操作です。
  関数$f(x)$の$x=a$における微分係数は、$\\lim_{h \\to 0} \\frac{f(a+h) - f(a)}{h}$ で定義されます。
  そして、この微分係数を$x$の関数として一般化したものが「導関数」で、$f'(x)$と書きます。
`,
                pitfall: {
                    title: "よくある間違い：微分係数と導関数の違い",
                    detail: `
微分係数は「特定の点における接線の傾き」という「値」です。
導関数は「任意の点における接線の傾きを表す関数」であり、「式」です。
混同しないように注意しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "関数 $f(x) = x^2$ の導関数を定義に基づいて求めなさい。",
                        answer: "$2x$",
                        hint: "微分の定義式に当てはめて計算してみましょう。",
                    },
                    {
                        question:
                            "関数 $f(x) = 3x + 1$ の導関数を定義に基づいて求めなさい。",
                        answer: "$3$",
                        hint: "微分の定義式を使います。直線の傾きを考えても良いでしょう。",
                    },
                ]),
            },
            {
                title: "基本的な微分公式",
                explanation: `
  毎回定義を使って微分するのは大変なので、便利な公式があります。
  1. $C$ (定数) の微分: $(C)' = 0$
  2. $x^n$ の微分: $(x^n)' = nx^{n-1}$
  3. 定数倍の微分: $(Cf(x))' = C(f(x))'$
  4. 和・差の微分: $(f(x) \\pm g(x))' = f'(x) \\pm g'(x)$
  これらの公式を組み合わせることで、多くの関数を微分できます。
`,
                pitfall: {
                    title: "よくある間違い：定数の微分を1にしてしまう",
                    detail: `
定数（数字のみの項）の微分は常に0です。
例えば、$(x^2 + 5)' = (x^2)' + (5)' = 2x + 0 = 2x$ となります。
$5$を$1$にしてしまう間違いが多いので注意しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "関数 $f(x) = 4x^3$ を微分しなさい。",
                        answer: "$12x^2$",
                        hint: "定数倍の公式と$x^n$の微分公式を使います。",
                    },
                    {
                        question:
                            "関数 $g(x) = x^5 - 2x^2 + 7$ を微分しなさい。",
                        answer: "$5x^4 - 4x$",
                        hint: "それぞれの項を個別に微分し、和・差の公式を適用しましょう。定数の微分に注意。",
                    },
                ]),
            },
            {
                title: "接線の傾き",
                explanation: `
  関数$y=f(x)$上の点$(a, f(a))$における接線の傾きは、その点での導関数の値、$f'(a)$で与えられます。
  つまり、導関数を求めてから$x=a$を代入すれば、接線の傾きがわかります。
`,
                pitfall: {
                    title: "よくある間違い：接線の傾きと接線の方程式を混同する",
                    detail: `
接線の傾きは単なる「数値」ですが、接線の方程式は「$y = mx + b$」のような「式」です。
接線の方程式を求めるには、傾き$m=f'(a)$と点$(a, f(a))$を使って、$y - f(a) = f'(a)(x - a)$ の公式を使います。
問題が「傾き」を求めているのか、「方程式」を求めているのか、よく確認しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "関数 $f(x) = x^2 + 3x$ の $x=1$ における接線の傾きを求めなさい。",
                        answer: "$5$",
                        hint: "まず$f'(x)$を求め、その後に$x=1$を代入しましょう。",
                    },
                    {
                        question:
                            "関数 $g(x) = 2x^3 - 4$ の $x=-1$ における接線の傾きを求めなさい。",
                        answer: "$6$",
                        hint: "同様に$g'(x)$を求めてから$x=-1$を代入します。",
                    },
                ]),
            },
            {
                title: "積の微分・商の微分",
                explanation: `
  関数の積や商を微分するための公式です。
  積の微分公式: $(f(x)g(x))' = f'(x)g(x) + f(x)g'(x)$
  商の微分公式: $\\left(\\frac{f(x)}{g(x)}\\right)' = \\frac{f'(x)g(x) - f(x)g'(x)}{(g(x))^2}$
  これらの公式は少し複雑ですが、慣れると非常に便利です。
`,
                pitfall: {
                    title: "よくある間違い：積の微分で単純にそれぞれを微分してしまう",
                    detail: `
$(f(x)g(x))' = f'(x)g'(x)$ と考えてしまう間違いが多いです。これは誤りです。
積の微分公式では、片方を微分し、もう片方はそのまま、という組み合わせを足し合わせます。
商の微分公式では、分子と分母の役割を間違えたり、分母を二乗し忘れたりすることに注意しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "関数 $f(x) = (x^2+1)(3x-2)$ を微分しなさい。",
                        answer: "$9x^2 - 4x + 3$",
                        hint: "積の微分公式 $(fg)' = f'g + fg'$ を使います。",
                    },
                    {
                        question:
                            "関数 $g(x) = \\frac{x}{x+1}$ を微分しなさい。",
                        answer: "$\\frac{1}{(x+1)^2}$",
                        hint: "商の微分公式 $\\left(\\frac{f}{g}\\right)' = \\frac{f'g - fg'}{g^2}$ を使います。",
                    },
                ]),
            },
            {
                title: "合成関数の微分",
                explanation: `
  関数の中に別の関数が入っている形（合成関数）を微分する公式です。
  $(f(g(x)))' = f'(g(x)) \\cdot g'(x)$
  つまり、「外側の関数を微分したもの」に「内側の関数を微分したもの」を掛け合わせます。
`,
                pitfall: {
                    title: "よくある間違い：内側の関数の微分を掛け忘れる",
                    detail: `
$(f(g(x)))'$ を $f'(g(x))$ だけで終わらせてしまう間違いが多いです。
例えば、$( (2x+1)^3 )'$ の場合、外側の関数は$(\\quad)^3$、内側の関数は$2x+1$です。
正しくは $3(2x+1)^2 \\cdot (2x+1)' = 3(2x+1)^2 \\cdot 2 = 6(2x+1)^2$ となります。
内側の関数の微分を掛け忘れないように注意しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "関数 $f(x) = (3x-2)^4$ を微分しなさい。",
                        answer: "$12(3x-2)^3$",
                        hint: "外側の微分と内側の微分を掛け合わせる合成関数の微分公式を使います。",
                    },
                    {
                        question:
                            "関数 $g(x) = \\sqrt{x^2+1}$ を微分しなさい。",
                        answer: "$\\frac{x}{\\sqrt{x^2+1}}$",
                        hint: "$\\sqrt{u}$ の微分は $\\frac{1}{2\\sqrt{u}}$ で、これに内側の関数 $x^2+1$ の微分を掛けます。",
                    },
                ]),
            },
            {
                title: "高次導関数",
                explanation: `
  導関数をさらに微分することで、第二導関数、第三導関数などを求めることができます。
  $f(x)$ の導関数を $f'(x)$、第二導関数を $f''(x)$、$f'''(x)$、一般に $f^{(n)}(x)$ と表記します。
  これらの導関数は、関数の増減や凹凸、変曲点などを調べるのに役立ちます。
`,
                pitfall: {
                    title: "よくある間違い：計算ミスを繰り返す",
                    detail: `
高次導関数を求める際は、前の導関数の計算ミスが次の導関数に影響します。
一つ一つの微分の計算を丁寧に、正確に行うことが重要ですし、
特に符号や指数に注意しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "関数 $f(x) = x^4 - 3x^2 + 5$ の第二導関数 $f''(x)$ を求めなさい。",
                        answer: "$12x^2 - 6$",
                        hint: "一度微分して$f'(x)$を求め、さらにもう一度微分して$f''(x)$を求めます。",
                    },
                    {
                        question:
                            "関数 $g(x) = \\sin(2x)$ の第二導関数 $g''(x)$ を求めなさい。",
                        answer: "$-4\\sin(2x)$",
                        hint: "合成関数の微分も考慮しながら、2回微分してみましょう。",
                    },
                ]),
            },
            {
                title: "増減・凹凸とグラフ",
                explanation: `
  導関数 $f'(x)$ の符号は関数の増減を示します。$f'(x) > 0$ なら増加、$f'(x) < 0$ なら減少です。
  第二導関数 $f''(x)$ の符号は関数の凹凸を示します。$f''(x) > 0$ なら下に凸、$f''(x) < 0$ なら上に凸です。
  $f''(x)=0$ となる点で凹凸が変化する場合、その点を変曲点と呼びます。
  これらの情報を使って、関数のグラフの概形を描くことができます。
`,
                pitfall: {
                    title: "よくある間違い：増減と凹凸の混同",
                    detail: `
$f'(x)$ は傾き（増加/減少）に関する情報、$f''(x)$ は曲がり具合（凹凸）に関する情報です。
これらを混同すると、グラフの概形を間違えてしまいます。
それぞれの導関数が何を表しているのかをしっかりと理解しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "関数 $f(x) = x^3 - 3x$ の増減を調べ、極値を求めなさい。",
                        answer: "$x=-1$ で極大値 $2$, $x=1$ で極小値 $-2$",
                        hint: "$f'(x)$ を計算し、その符号の変化を調べましょう。",
                    },
                    {
                        question:
                            "関数 $f(x) = x^4 - 4x^3$ の凹凸を調べ、変曲点があればその座標を求めなさい。",
                        answer: "$x=0$ で変曲点 $(0,0)$, $x=2$ で変曲点 $(2,-16)$",
                        hint: "$f''(x)$ を計算し、その符号の変化を調べましょう。",
                    },
                ]),
            },
            {
                title: "最大・最小",
                explanation: `
  関数の最大値や最小値を求めるには、極値と定義域の端点での関数の値を比較します。
  閉区間 $[a, b]$ での最大値・最小値を求める手順は以下の通りです。
  1. $f'(x)=0$ となる$x$の値を求め、極値を計算する。
  2. 定義域の端点 $f(a)$、$f(b)$ の値を計算する。
  3. これらの値の中で最も大きいものが最大値、最も小さいものが最小値です。
`,
                pitfall: {
                    title: "よくある間違い：端点の値を考慮し忘れる",
                    detail: `
極値だけを調べて、定義域の端点での関数の値を考慮し忘れる間違いが多いです。
特に、定義域が閉区間である場合、最大値や最小値は極値ではなく端点でとることがあります。
必ず、極値と端点の両方を比較するようにしましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "関数 $f(x) = x^3 - 3x^2 + 2$ の閉区間 $[-1, 3]$ における最大値と最小値を求めなさい。",
                        answer: "最大値: $2$ ($x=0$, $x=3$), 最小値: $-2$ ($x=2$)",
                        hint: "$f'(x)=0$となる点と、定義域の端点での関数値をすべて計算し、比較しましょう。",
                    },
                    {
                        question:
                            "関数 $g(x) = x + \\frac{4}{x}$ の $x>0$ における最小値を求めなさい。",
                        answer: "$4$",
                        hint: "相加平均・相乗平均の関係を使うか、$g'(x)$ を調べて増減表を書きましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "積分", // トピック名
        steps: [
            {
                title: "不定積分の概念と基本公式",
                explanation: `
  積分は微分の逆の操作です。ある関数を微分すると元の関数になるような関数を求めることを「積分」と呼びます。
  $f(x)$ の不定積分は $\\int f(x) dx$ と表記され、$F'(x) = f(x)$ となる $F(x)$ を $f(x)$ の原始関数と呼びます。
  不定積分の基本公式: $\\int x^n dx = \\frac{1}{n+1}x^{n+1} + C$ （ただし、$n \\neq -1$）
  $C$ は積分定数と呼ばれ、任意の定数です。
`,
                pitfall: {
                    title: "よくある間違い：積分定数Cを忘れる",
                    detail: `
不定積分では、必ず積分定数 $C$ を加える必要があります。
なぜなら、定数を微分すると0になるため、元の関数がどのような定数を含んでいたか分からないからです。
例えば、$(x^2)' = 2x$ ですが、$(x^2+5)' = 2x$ でもあります。
したがって、$\\int 2x dx = x^2 + C$ となります。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$\\int (3x^2 - 2x + 1) dx$ を求めなさい。",
                        answer: "$x^3 - x^2 + x + C$",
                        hint: "各項を個別に積分し、最後に積分定数Cをつけましょう。",
                    },
                    {
                        question:
                            "$\\int (\\sqrt{x} + \\frac{1}{x^2}) dx$ を求めなさい。",
                        answer: "$\\frac{2}{3} x^{\\frac{3}{2}} - \\frac{1}{x} + C$",
                        hint: "$\\sqrt{x} = x^{\\frac{1}{2}}$、$\\frac{1}{x^2} = x^{-2}$ と指数表記に直してから積分公式を使いましょう。",
                    },
                ]),
            },
            {
                title: "置換積分法",
                explanation: `
  複雑な形の積分を、変数変換によって簡単な形に変換してから積分する方法です。
  例えば、$\\int f(g(x))g'(x) dx$ のような形の場合、$u = g(x)$ と置くと $du = g'(x) dx$ となり、
  $\\int f(u) du$ の形に変換できます。
`,
                pitfall: {
                    title: "よくある間違い：dxの変換を忘れる、定積分の場合は積分範囲を変え忘れる",
                    detail: `
置換積分を行う際、最も忘れやすいのが $dx$ を $du$ に変換することです。
$du = g'(x) dx$ の関係を必ず利用しましょう。
また、定積分の場合は、変数を $x$ から $u$ に変えたら、積分範囲も $x$ の範囲から $u$ の範囲に変換する必要があります。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$\\int (2x+1)^3 dx$ を求めなさい。",
                        answer: "$\\frac{1}{8} (2x+1)^4 + C$",
                        hint: "$u = 2x+1$ と置いてみましょう。",
                    },
                    {
                        question: "$\\int x \\sqrt{x^2+1} dx$ を求めなさい。",
                        answer: "$\\frac{1}{3} (x^2+1)^{\\frac{3}{2}} + C$",
                        hint: "$u = x^2+1$ と置いてみましょう。",
                    },
                ]),
            },
            {
                title: "部分積分法",
                explanation: `
  積の形をした関数を積分するための公式です。
  $\\int f(x)g'(x) dx = f(x)g(x) - \\int f'(x)g(x) dx$
  この公式を使うには、$f(x)$ と $g'(x)$ を適切に選ぶことが重要です。
  一般的には、微分すると簡単になる関数を $f(x)$、積分しやすい関数を $g'(x)$ に選びます。
`,
                pitfall: {
                    title: "よくある間違い：f(x)とg'(x)の選び方を間違える",
                    detail: `
部分積分法は $f(x)$ と $g'(x)$ の選び方で計算の難易度が大きく変わります。
例えば、$\\int x e^x dx$ の場合、$f(x)=x, g'(x)=e^x$ と選ぶと計算が楽になります。
逆に選ぶと、より複雑な積分が出てきてしまいます。
「ロガリズミック（対数関数）、インバース（逆三角関数）、アルジェブライック（多項式）、トリゴノメトリック（三角関数）、エクスポネンシャル（指数関数）」の順で $f(x)$ を選ぶと良いとされています（Liateの法則）。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$\\int x e^x dx$ を求めなさい。",
                        answer: "$xe^x - e^x + C$",
                        hint: "$f(x) = x$, $g'(x) = e^x$ と置いて部分積分公式を適用しましょう。",
                    },
                    {
                        question: "$\\int x \\sin x dx$ を求めなさい。",
                        answer: "$-x \\cos x + \\sin x + C$",
                        hint: "$f(x) = x$, $g'(x) = \\sin x$ と置いて部分積分公式を適用しましょう。",
                    },
                ]),
            },
            {
                title: "定積分の概念と計算",
                explanation: `
  定積分は、関数とx軸で囲まれた部分の面積を求めることに対応します。
  不定積分と異なり、積分範囲（下端と上端）が指定され、結果は数値になります。
  $\\int_a^b f(x) dx = [F(x)]_a^b = F(b) - F(a)$
  ここで $F(x)$ は $f(x)$ の原始関数です。
`,
                pitfall: {
                    title: "よくある間違い：計算ミスや符号ミス",
                    detail: `
定積分の計算では、$F(b) - F(a)$ の引き算の順序や、負の数の計算での符号ミスがよく発生します。
特に、原始関数を求めた後に代入する値を間違えたり、引き算の際に括弧を付け忘れたりしないように注意しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$\\int_0^1 (x^2 + 1) dx$ を計算しなさい。",
                        answer: "$\\frac{4}{3}$",
                        hint: "まず不定積分を求め、その後で上端と下端の値を代入して引き算します。",
                    },
                    {
                        question: "$\\int_1^2 (3x^2 - 4x) dx$ を計算しなさい。",
                        answer: "$2$",
                        hint: "不定積分を求めてから、$[F(x)]_1^2 = F(2) - F(1)$ を計算します。",
                    },
                ]),
            },
            {
                title: "面積",
                explanation: `
  定積分は、曲線とx軸、または複数の曲線で囲まれた領域の面積を求めるのにも使われます。
  x軸より上にある部分の面積は正、下にある部分の面積は負として計算されます。
  面積を求める場合は、常に正の値になるように絶対値を取ったり、区間を分けたりする必要があります。
  2つの曲線 $y=f(x)$ と $y=g(x)$ で囲まれた面積は、$\\int_a^b |f(x) - g(x)| dx$ で求められます。
`,
                pitfall: {
                    title: "よくある間違い：x軸より下の部分の符号を考慮しない",
                    detail: `
面積は常に正の値です。関数がx軸の下にある区間では、定積分の値は負になります。
この場合、その区間の定積分の値に絶対値をつけるか、$-f(x)$ を積分するようにしましょう。
また、複数の曲線で囲まれる場合は、どちらの関数が上にあるかを区間ごとに確認しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "曲線 $y = x^2 - 1$ と $x$軸で囲まれた部分の面積を求めなさい。",
                        answer: "$\\frac{4}{3}$",
                        hint: "曲線がx軸と交わる点を求め、その区間で積分します。x軸より下の部分の符号に注意しましょう。",
                    },
                    {
                        question:
                            "2つの曲線 $y = x^2$ と $y = x+2$ で囲まれた部分の面積を求めなさい。",
                        answer: "$\\frac{9}{2}$",
                        hint: "2つの曲線の交点を求め、どちらの関数が上にあるかを確認して積分します。",
                    },
                ]),
            },
            {
                title: "体積",
                explanation: `
  積分は、図形を回転させてできる立体の体積を求めるのにも使われます（回転体の体積）。
  関数 $y=f(x)$ を $x$軸の周りに回転させてできる立体の体積は、
  $\\int_a^b \\pi (f(x))^2 dx$ で求められます。
  これは、円の面積 $\\pi r^2$ を積み重ねていくイメージです。
`,
                pitfall: {
                    title: "よくある間違い：公式の適用ミス",
                    detail: `
体積の公式で $\\pi$ を掛け忘れたり、$f(x)$ を二乗し忘れたりすることがよくあります。
また、回転軸が $x$軸以外の場合や、2つの曲線間の回転体の体積を求める場合は、公式が少し変わるため注意が必要です。
公式の意味を理解し、正しく適用することが大切です。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "曲線 $y = \\sqrt{x}$ と $x$軸、直線 $x=1$ で囲まれた部分を $x$軸の周りに回転させてできる立体の体積を求めなさい。",
                        answer: "$\\frac{\\pi}{2}$",
                        hint: "公式 $\\int_a^b \\pi (f(x))^2 dx$ を使います。$f(x) = \\sqrt{x}$ です。",
                    },
                    {
                        question:
                            "曲線 $y = x^2$ と直線 $y=x$ で囲まれた部分を $x$軸の周りに回転させてできる立体の体積を求めなさい。",
                        answer: "$\\frac{2\\pi}{15}$",
                        hint: "2つの曲線で囲まれた領域を回転させる場合、外側の半径の二乗から内側の半径の二乗を引いたものを積分します。",
                    },
                ]),
            },
        ],
    },
];

// 全ての科目のデータをまとめる
const allSubjectsData: SubjectData = {
    数学I: math1Lessons,
    数学A: mathALessons,
    数学II: math2Lessons,
    数学B: mathBLessons,
    数学III: math3Lessons, // 既存の微分積分コンテンツを数学IIIとして利用
};

export default allSubjectsData;

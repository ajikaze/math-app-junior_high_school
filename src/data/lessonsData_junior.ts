// 学習ステップの落とし穴の型定義
interface Pitfall {
    title: string;
    detail: string;
}

// 練習問題の型定義
export interface Problem {
    question: string;
    answer: string;
    hint: string;
}

// 学習ステップの型定義
export interface LearningStep {
    title: string;
    explanation: string;
    pitfall: Pitfall;
    problems?: Problem[];
}

// 学習トピックの型定義
export interface LearningTopic {
    topic: string;
    steps: LearningStep[];
}

// 科目データの型定義
interface SubjectData {
    [key: string]: LearningTopic[];
}

// LaTeX変換用の正規表現置換関数
export function toLatexMath(str: string): string {
    if (!str) return str;
    let s = str;
    // 「ポイント：」の前後に改行を追加
    s = s.replace(/\n?\s*ポイント：/g, "\n\nポイント：\n");
    // 改行を<br>に変換
    s = s.replace(/\n/g, "<br>");
    // sqrt(2) → \sqrt{2}
    s = s.replace(/sqrt\(([^)]+)\)/g, "\\sqrt{$1}");
    // <=, >=
    s = s.replace(/<=/g, " \\le ");
    s = s.replace(/>=/g, " \\ge ");
    // pi → \pi
    s = s.replace(/\bpi\b/g, "\\pi");
    // 分数 例: 1/2 → \frac{1}{2}（ただし小数や式の一部でない場合のみ）
    s = s.replace(
        /(?<![\d.])([0-9]+)\s*\/\s*([0-9]+)(?![\d.])/g,
        "\\frac{$1}{$2}"
    );
    // 乗数 例: x^2 → x^{2}
    s = s.replace(/([a-zA-Z0-9]+)\^(-?[a-zA-Z0-9]+)/g, "$1^{$2}");
    return s;
}

// problemsのanswerをLaTeX記法に自動変換
function normalizeProblems(problems: Problem[]): Problem[] {
    return problems.map((p) => {
        let answer = p.answer;
        if (typeof answer === "string") {
            answer = toLatexMath(answer);
        }
        return { ...p, answer };
    });
}

// 中学1年生 の学習コンテンツ
const juniorHigh1Lessons: LearningTopic[] = [
    {
        topic: "正の数・負の数",
        steps: [
            {
                title: "正の数と負の数",
                explanation: `
  正の数は、0より大きい数です。例：1, 2, 3, 4, 5...
  負の数は、0より小さい数です。例：-1, -2, -3, -4, -5...
  0は正の数でも負の数でもありません。

  数直線上では、右に行くほど大きい数、左に行くほど小さい数になります。

  ポイント：
  ・正の数は「+」の記号を省略できる
  ・負の数は必ず「-」の記号をつける
  ・0は正の数でも負の数でもない
`,
                pitfall: {
                    title: "よくある間違い：負の数の記号の付け忘れ",
                    detail: `
負の数を表すときは、必ず「-」の記号をつけましょう。
例えば、「マイナス3」は「-3」と書きます。「3」だけでは正の数になってしまいます。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "次の数を正の数、負の数、0に分類しなさい。3, -5, 0, -2, 7",
                        answer: "正の数：3, 7、負の数：-5, -2、0：0",
                        hint: "0より大きいか小さいか、または0かを考えましょう。",
                    },
                    {
                        question: "数直線上で、-3と2のどちらが大きいですか？",
                        answer: "2",
                        hint: "数直線上で右にある方が大きい数です。",
                    },
                ]),
            },
            {
                title: "正の数・負の数の加法・減法",
                explanation: `
  正の数・負の数の足し算・引き算のルールを覚えましょう。

  加法（足し算）：
  ・同符号の数の和：絶対値の和に共通の符号をつける
  ・異符号の数の和：絶対値の差に、絶対値の大きい方の符号をつける

  減法（引き算）：
  ・減法は加法に直して計算する
  ・a - b = a + (-b)

  ポイント：
  ・同符号なら絶対値を足す
  ・異符号なら絶対値の差をとる
  ・引き算は足し算に直す
`,
                pitfall: {
                    title: "よくある間違い：符号の決定ミス",
                    detail: `
異符号の数の加法では、絶対値の差をとった後、絶対値の大きい方の符号をつけることを忘れがちです。
例えば、(-5) + 3 では、絶対値の差は2で、絶対値の大きい方（5）の符号はマイナスなので、答えは-2になります。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "(-3) + (-5) を計算しなさい。",
                        answer: "-8",
                        hint: "同符号の数の和は、絶対値の和に共通の符号をつけます。",
                    },
                    {
                        question: "(-7) + 4 を計算しなさい。",
                        answer: "-3",
                        hint: "異符号の数の和は、絶対値の差に絶対値の大きい方の符号をつけます。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "文字と式",
        steps: [
            {
                title: "文字を使った式",
                explanation: `
  文字を使った式では、文字は数を表す記号として使います。
  例：x + 5, 2y - 3, 3a + 2b

  文字式の表し方のルール：
  ・文字と数の積では、×の記号を省略する（例：3×x = 3x）
  ・文字と文字の積では、×の記号を省略する（例：a×b = ab）
  ・1×x = x（1は省略する）
  ・(-1)×x = -x（-1は-だけ書く）

  ポイント：
  ・×の記号は省略する
  ・1は省略する
  ・文字の順序はアルファベット順にする
`,
                pitfall: {
                    title: "よくある間違い：×の記号の省略ミス",
                    detail: `
文字式では×の記号を省略するルールがありますが、数字同士の積では省略しません。
例えば、3×5は15と書きますが、3×xは3xと書きます。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "次の式を文字式の表し方のルールに従って書き直しなさい。3×x×2",
                        answer: "6x",
                        hint: "数字同士は計算し、文字との積では×を省略します。",
                    },
                    {
                        question:
                            "次の式を文字式の表し方のルールに従って書き直しなさい。1×a×b",
                        answer: "ab",
                        hint: "1は省略し、文字同士の積では×を省略します。",
                    },
                ]),
            },
            {
                title: "式の値",
                explanation: `
  文字式に、文字に数を代入して計算した結果を「式の値」といいます。

  例：x + 3 に x = 2 を代入すると、2 + 3 = 5

  代入の手順：
  1. 文字に数を代入する
  2. 計算する
  3. 答えを求める

  ポイント：
  ・文字に数を代入するときは、かっこをつけるとよい
  ・負の数を代入するときは特に注意
`,
                pitfall: {
                    title: "よくある間違い：負の数の代入",
                    detail: `
負の数を代入するときは、かっこをつけて代入しましょう。
例えば、x = -2 のとき、x² = (-2)² = 4 です。
かっこをつけないと、-2² = -4 となってしまいます。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "x = 3 のとき、2x + 1 の値を求めなさい。",
                        answer: "7",
                        hint: "xに3を代入して計算しましょう。",
                    },
                    {
                        question: "a = -2 のとき、a² + 3a の値を求めなさい。",
                        answer: "-2",
                        hint: "負の数を代入するときはかっこをつけましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "1次方程式",
        steps: [
            {
                title: "1次方程式の解き方",
                explanation: `
  1次方程式は、文字の次数が1の方程式です。
  例：2x + 3 = 7, 3x - 5 = x + 1

  解き方の手順：
  1. 文字を含む項を左辺に、数字だけの項を右辺に移項する
  2. 両辺を整理する
  3. 文字の係数で両辺を割る

  移項のルール：
  ・項を移項するときは符号を変える
  ・左辺から右辺、右辺から左辺に移す

  ポイント：
  ・移項するときは符号を変える
  ・両辺に同じ数を足しても引いても等式は成り立つ
  ・両辺に同じ数をかけても割っても等式は成り立つ
`,
                pitfall: {
                    title: "よくある間違い：移項の符号ミス",
                    detail: `
移項するときは、必ず符号を変えましょう。
例えば、2x + 3 = 7 で、3を右辺に移項すると、2x = 7 - 3 となります。
符号を変え忘れると、2x = 7 + 3 となって間違いになります。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "方程式 2x + 3 = 7 を解きなさい。",
                        answer: "x = 2",
                        hint: "3を右辺に移項してから、両辺を2で割りましょう。",
                    },
                    {
                        question: "方程式 3x - 5 = x + 1 を解きなさい。",
                        answer: "x = 3",
                        hint: "文字を含む項を左辺に、数字だけの項を右辺に移項しましょう。",
                    },
                ]),
            },
        ],
    },
];

// 中学2年生 の学習コンテンツ
const juniorHigh2Lessons: LearningTopic[] = [
    {
        topic: "式の計算",
        steps: [
            {
                title: "単項式と多項式",
                explanation: `
  単項式は、数や文字の積だけでできている式です。
  例：3x, -2y², 5

  多項式は、単項式の和でできている式です。
  例：2x + 3, x² - 2x + 1

  同類項とは、文字の部分が同じ項のことです。
  例：2x と 3x は同類項、2x と 2y は同類項ではない

  同類項の整理：
  ・同類項の係数を足し合わせる
  ・例：2x + 3x = 5x

  ポイント：
  ・単項式は積だけ、多項式は和の形
  ・同類項は文字の部分が同じ
  ・同類項は係数を足し合わせる
`,
                pitfall: {
                    title: "よくある間違い：同類項の判断ミス",
                    detail: `
同類項かどうかは、文字の部分（係数以外の部分）が同じかどうかで判断します。
x² と x は同類項ではありません。x² と 2x² が同類項です。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "次の式の同類項を整理しなさい。2x + 3y + 4x - y",
                        answer: "6x + 2y",
                        hint: "xの項とyの項をそれぞれまとめましょう。",
                    },
                    {
                        question:
                            "次の式の同類項を整理しなさい。3x² + 2x + 5x² - x",
                        answer: "8x² + x",
                        hint: "x²の項とxの項をそれぞれまとめましょう。",
                    },
                ]),
            },
            {
                title: "式の加法・減法",
                explanation: `
  多項式の加法・減法は、同類項をまとめて計算します。

  加法（足し算）：
  ・同類項の係数を足し合わせる
  ・例：(2x + 3) + (x + 1) = 3x + 4

  減法（引き算）：
  ・引く式の各項の符号を変えてから足し算する
  ・例：(2x + 3) - (x + 1) = (2x + 3) + (-x - 1) = x + 2

  ポイント：
  ・同類項をまとめる
  ・引き算は符号を変えて足し算
  ・かっこをはずすときは符号に注意
`,
                pitfall: {
                    title: "よくある間違い：引き算の符号ミス",
                    detail: `
多項式の引き算では、引く式の各項の符号を変えてから足し算します。
例えば、(2x + 3) - (x + 1) では、(x + 1) の各項の符号を変えて (-x - 1) にしてから足し算します。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "(3x + 2) + (2x - 1) を計算しなさい。",
                        answer: "5x + 1",
                        hint: "同類項をまとめましょう。",
                    },
                    {
                        question: "(4x + 3) - (2x + 1) を計算しなさい。",
                        answer: "2x + 2",
                        hint: "引く式の各項の符号を変えてから足し算しましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "連立方程式",
        steps: [
            {
                title: "連立方程式の解き方",
                explanation: `
  連立方程式は、2つの文字を含む2つの方程式を同時に満たす解を求める問題です。

  解き方の手順：
  1. 1つの文字を消去する
  2. 残った文字の方程式を解く
  3. 求めた値を元の方程式に代入して、もう1つの文字の値を求める

  代入法：
  ・1つの方程式を1つの文字について解く
  ・その式を他の方程式に代入する

  加減法：
  ・2つの方程式を足したり引いたりして、1つの文字を消去する

  ポイント：
  ・1つの文字を消去する
  ・代入法と加減法を使い分ける
  ・答えは必ず確かめる
`,
                pitfall: {
                    title: "よくある間違い：代入のミス",
                    detail: `
代入法を使うときは、1つの文字について解いた式を、他の方程式の文字に代入します。
代入する際に、かっこをつけることを忘れないようにしましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "連立方程式 x + y = 5, 2x - y = 1 を解きなさい。",
                        answer: "x = 2, y = 3",
                        hint: "加減法を使ってyを消去しましょう。",
                    },
                    {
                        question:
                            "連立方程式 2x + y = 7, x - y = 1 を解きなさい。",
                        answer: "x = 3, y = 1",
                        hint: "加減法を使ってyを消去しましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "1次関数",
        steps: [
            {
                title: "1次関数のグラフ",
                explanation: `
  1次関数は、y = ax + b の形で表される関数です。
  グラフは直線になります。

  グラフの特徴：
  ・傾きが a の直線
  ・y切片が b（x = 0 のときのyの値）
  ・x切片が -b/a（y = 0 のときのxの値）

  グラフの描き方：
  1. y切片 (0, b) をとる
  2. 傾き a を使って、もう1つの点をとる
  3. 2点を直線で結ぶ

  ポイント：
  ・傾きは「右に1進むと上にa進む」
  ・y切片はx = 0のときのyの値
  ・グラフは直線になる
`,
                pitfall: {
                    title: "よくある間違い：傾きの読み取りミス",
                    detail: `
傾きaは、「xが1増加したときのyの増加量」を表します。
例えば、y = 2x + 1 の傾きは2で、「右に1進むと上に2進む」ことを意味します。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "1次関数 y = 2x + 3 のグラフの傾きとy切片を求めなさい。",
                        answer: "傾き：2、y切片：3",
                        hint: "y = ax + b の形で、aが傾き、bがy切片です。",
                    },
                    {
                        question:
                            "1次関数 y = -x + 2 のグラフの傾きとy切片を求めなさい。",
                        answer: "傾き：-1、y切片：2",
                        hint: "y = ax + b の形で、aが傾き、bがy切片です。",
                    },
                ]),
            },
        ],
    },
];

// 中学3年生 の学習コンテンツ
const juniorHigh3Lessons: LearningTopic[] = [
    {
        topic: "多項式",
        steps: [
            {
                title: "多項式の乗法",
                explanation: `
  多項式の乗法（かけ算）は、分配法則を使って計算します。

  分配法則：
  a(b + c) = ab + ac

  多項式×多項式：
  (a + b)(c + d) = ac + ad + bc + bd

  計算の手順：
  1. 1つ目の多項式の各項に、2つ目の多項式の各項をかける
  2. 同類項をまとめる

  ポイント：
  ・分配法則を使う
  ・すべての項をかけ合わせる
  ・同類項をまとめる
`,
                pitfall: {
                    title: "よくある間違い：項の掛け忘れ",
                    detail: `
多項式の乗法では、1つ目の多項式の各項に、2つ目の多項式の各項をすべてかけ合わせる必要があります。
例えば、(x + 2)(x + 3) では、x×x, x×3, 2×x, 2×3 の4つの項をすべて計算します。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "(x + 2)(x + 3) を展開しなさい。",
                        answer: "x² + 5x + 6",
                        hint: "分配法則を使って、すべての項をかけ合わせましょう。",
                    },
                    {
                        question: "(2x + 1)(x - 2) を展開しなさい。",
                        answer: "2x² - 3x - 2",
                        hint: "分配法則を使って、すべての項をかけ合わせましょう。",
                    },
                ]),
            },
            {
                title: "因数分解",
                explanation: `
  因数分解は、多項式を単項式や多項式の積の形に変形することです。

  基本的な因数分解：
  ・共通因数をくくり出す：ax + ay = a(x + y)
  ・x² + (a + b)x + ab = (x + a)(x + b)

  因数分解の手順：
  1. 共通因数があるかチェック
  2. 公式が使えるかチェック
  3. たすきがけを試す

  ポイント：
  ・共通因数を先にくくり出す
  ・公式を覚えておく
  ・たすきがけで試行錯誤
`,
                pitfall: {
                    title: "よくある間違い：共通因数の見落とし",
                    detail: `
因数分解では、まず共通因数があるかどうかをチェックしましょう。
例えば、2x² + 4x では、2xが共通因数なので、2x(x + 2) と因数分解できます。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "x² + 5x + 6 を因数分解しなさい。",
                        answer: "(x + 2)(x + 3)",
                        hint: "掛けて6、足して5になる2つの数を探しましょう。",
                    },
                    {
                        question: "2x² + 6x を因数分解しなさい。",
                        answer: "2x(x + 3)",
                        hint: "まず共通因数をくくり出しましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "平方根",
        steps: [
            {
                title: "平方根の計算",
                explanation: `
  平方根は、2乗するとその数になる数のことです。
  例：√4 = 2（2² = 4）

  平方根の性質：
  ・√a × √b = √(ab)
  ・√a ÷ √b = √(a/b)
  ・√(a²) = |a|

  平方根の計算：
  ・根号の中をできるだけ小さくする
  ・分母に根号があるときは有理化する

  ポイント：
  ・根号の中を小さくする
  ・分母の有理化を忘れずに
  ・絶対値に注意
`,
                pitfall: {
                    title: "よくある間違い：根号の足し算・引き算",
                    detail: `
√a + √b = √(a + b) ではありません。
根号の中の数が同じ場合のみ、係数を足し引きできます。
例えば、2√3 + 4√3 = 6√3 ですが、√2 + √3 はこれ以上簡単にできません。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "√8 + √2 を簡単にしなさい。",
                        answer: "3√2",
                        hint: "√8 = 2√2 に変形してから計算しましょう。",
                    },
                    {
                        question: "1/√3 を有理化しなさい。",
                        answer: "√3/3",
                        hint: "分母と分子に√3をかけましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "2次方程式",
        steps: [
            {
                title: "2次方程式の解き方",
                explanation: `
  2次方程式は、x²を含む方程式です。
  例：x² + 5x + 6 = 0

  解き方：
  1. 因数分解できるか試す
  2. 解の公式を使う：x = (-b ± √(b² - 4ac)) / (2a)

  因数分解による解法：
  ・左辺を因数分解して、(x + a)(x + b) = 0 の形にする
  ・x + a = 0 または x + b = 0 より、x = -a, x = -b

  解の公式：
  ・ax² + bx + c = 0 の解は x = (-b ± √(b² - 4ac)) / (2a)

  ポイント：
  ・まず因数分解を試す
  ・解の公式は最後の手段
  ・判別式で解の個数が分かる
`,
                pitfall: {
                    title: "よくある間違い：解の公式の符号ミス",
                    detail: `
解の公式の -b や 2a の符号、± の後の根号内の計算ミスが多いです。
特に、判別式 b² - 4ac の計算は慎重に行いましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "x² - 5x + 6 = 0 を解きなさい。",
                        answer: "x = 2, 3",
                        hint: "因数分解を試してみましょう。",
                    },
                    {
                        question: "x² + 2x - 1 = 0 を解きなさい。",
                        answer: "x = -1 ± √2",
                        hint: "解の公式を使いましょう。",
                    },
                ]),
            },
        ],
    },
];

// 全ての科目のデータをまとめる
const allSubjectsData: SubjectData = {
    中学1年生: juniorHigh1Lessons,
    中学2年生: juniorHigh2Lessons,
    中学3年生: juniorHigh3Lessons,
};

export default allSubjectsData;
